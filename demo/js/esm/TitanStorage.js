/*! For license information please see TitanStorage.js.LICENSE.txt */
var __webpack_modules__={45:e=>{e.exports=function(e,t){var r=new Array(arguments.length-1),n=0,o=2,i=!0;for(;o<arguments.length;)r[n++]=arguments[o++];return new Promise((function(o,a){r[n]=function(e){if(i)if(i=!1,e)a(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];o.apply(null,t)}};try{e.apply(t||null,r)}catch(e){i&&(i=!1,a(e))}}))}},839:(e,t)=>{var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=new Array(64),o=new Array(123),i=0;i<64;)o[n[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;r.encode=function(e,t,r){for(var o,i=null,a=[],s=0,c=0;t<r;){var u=e[t++];switch(c){case 0:a[s++]=n[u>>2],o=(3&u)<<4,c=1;break;case 1:a[s++]=n[o|u>>4],o=(15&u)<<2,c=2;break;case 2:a[s++]=n[o|u>>6],a[s++]=n[63&u],c=0}s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=n[o],a[s++]=61,1===c&&(a[s++]=61)),i?(s&&i.push(String.fromCharCode.apply(String,a.slice(0,s))),i.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var a="invalid encoding";r.decode=function(e,t,r){for(var n,i=r,s=0,c=0;c<e.length;){var u=e.charCodeAt(c++);if(61===u&&s>1)break;if(void 0===(u=o[u]))throw Error(a);switch(s){case 0:n=u,s=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,s=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,s=3;break;case 3:t[r++]=(3&n)<<6|u,s=0}}if(1===s)throw Error(a);return r-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},358:e=>{function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},410:e=>{function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3]}function i(e,n,o){t[0]=e,n[o]=r[3],n[o+1]=r[2],n[o+2]=r[1],n[o+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function s(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?o:i,e.writeFloatBE=n?i:o,e.readFloatLE=n?a:s,e.readFloatBE=n?s:a}():function(){function t(e,t,r,n){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var i=Math.floor(Math.log(t)/Math.LN2);e((o<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,n)}}function a(e,t,r){var n=e(t,r),o=2*(n>>31)+1,i=n>>>23&255,a=8388607&n;return 255===i?a?NaN:o*(1/0):0===i?1401298464324817e-60*o*a:o*Math.pow(2,i-150)*(a+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,n),e.readFloatLE=a.bind(null,o),e.readFloatBE=a.bind(null,i)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3],n[o+4]=r[4],n[o+5]=r[5],n[o+6]=r[6],n[o+7]=r[7]}function i(e,n,o){t[0]=e,n[o]=r[7],n[o+1]=r[6],n[o+2]=r[5],n[o+3]=r[4],n[o+4]=r[3],n[o+5]=r[2],n[o+6]=r[1],n[o+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function s(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?o:i,e.writeDoubleBE=n?i:o,e.readDoubleLE=n?a:s,e.readDoubleBE=n?s:a}():function(){function t(e,t,r,n,o,i){var a=n<0?1:0;if(a&&(n=-n),0===n)e(0,o,i+t),e(1/n>0?0:2147483648,o,i+r);else if(isNaN(n))e(0,o,i+t),e(2146959360,o,i+r);else if(n>17976931348623157e292)e(0,o,i+t),e((a<<31|2146435072)>>>0,o,i+r);else{var s;if(n<22250738585072014e-324)e((s=n/5e-324)>>>0,o,i+t),e((a<<31|s/4294967296)>>>0,o,i+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(s=n*Math.pow(2,-c))>>>0,o,i+t),e((a<<31|c+1023<<20|1048576*s&1048575)>>>0,o,i+r)}}}function a(e,t,r,n,o){var i=e(n,o+t),a=e(n,o+r),s=2*(a>>31)+1,c=a>>>20&2047,u=4294967296*(1048575&a)+i;return 2047===c?u?NaN:s*(1/0):0===c?5e-324*s*u:s*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=a.bind(null,o,0,4),e.readDoubleBE=a.bind(null,i,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function i(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},153:module=>{function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},390:e=>{e.exports=function(e,t,r){var n=r||8192,o=n>>>1,i=null,a=n;return function(r){if(r<1||r>o)return e(r);a+r>n&&(i=e(n),a=0);var s=t.call(i,a,a+=r);return 7&a&&(a=1+(7|a)),s}}},447:(e,t)=>{var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,o=null,i=[],a=0;t<r;)(n=e[t++])<128?i[a++]=n:n>191&&n<224?i[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[a++]=55296+(n>>10),i[a++]=56320+(1023&n)):i[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),a=0);return o?(a&&o.push(String.fromCharCode.apply(String,i.slice(0,a))),o.join("")):String.fromCharCode.apply(String,i.slice(0,a))},r.write=function(e,t,r){for(var n,o,i=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(o=e.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&o),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-i}},232:(e,t,r)=>{var n,o,i;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}i=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],o=e[2],i=e[3];n=((n+=((o=((o+=((i=((i+=((r=((r+=(n&o|~n&i)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&o)+t[1]-389564586|0)<<12|i>>>20)+r|0)&r|~i&n)+t[2]+606105819|0)<<17|o>>>15)+i|0)&i|~o&r)+t[3]-1044525330|0)<<22|n>>>10)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n&o|~n&i)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&o)+t[5]+1200080426|0)<<12|i>>>20)+r|0)&r|~i&n)+t[6]-1473231341|0)<<17|o>>>15)+i|0)&i|~o&r)+t[7]-45705983|0)<<22|n>>>10)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n&o|~n&i)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&o)+t[9]-1958414417|0)<<12|i>>>20)+r|0)&r|~i&n)+t[10]-42063|0)<<17|o>>>15)+i|0)&i|~o&r)+t[11]-1990404162|0)<<22|n>>>10)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n&o|~n&i)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&o)+t[13]-40341101|0)<<12|i>>>20)+r|0)&r|~i&n)+t[14]-1502002290|0)<<17|o>>>15)+i|0)&i|~o&r)+t[15]+1236535329|0)<<22|n>>>10)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n&i|o&~i)+t[1]-165796510|0)<<5|r>>>27)+n|0)&o|n&~o)+t[6]-1069501632|0)<<9|i>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|o>>>18)+i|0)&r|i&~r)+t[0]-373897302|0)<<20|n>>>12)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n&i|o&~i)+t[5]-701558691|0)<<5|r>>>27)+n|0)&o|n&~o)+t[10]+38016083|0)<<9|i>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|o>>>18)+i|0)&r|i&~r)+t[4]-405537848|0)<<20|n>>>12)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n&i|o&~i)+t[9]+568446438|0)<<5|r>>>27)+n|0)&o|n&~o)+t[14]-1019803690|0)<<9|i>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|o>>>18)+i|0)&r|i&~r)+t[8]+1163531501|0)<<20|n>>>12)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n&i|o&~i)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&o|n&~o)+t[2]-51403784|0)<<9|i>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|o>>>18)+i|0)&r|i&~r)+t[12]-1926607734|0)<<20|n>>>12)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n^o^i)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^o)+t[8]-2022574463|0)<<11|i>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|o>>>16)+i|0)^i^r)+t[14]-35309556|0)<<23|n>>>9)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n^o^i)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^o)+t[4]+1272893353|0)<<11|i>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|o>>>16)+i|0)^i^r)+t[10]-1094730640|0)<<23|n>>>9)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n^o^i)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^o)+t[0]-358537222|0)<<11|i>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|o>>>16)+i|0)^i^r)+t[6]+76029189|0)<<23|n>>>9)+o|0,n=((n+=((o=((o+=((i=((i+=((r=((r+=(n^o^i)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^o)+t[12]-421815835|0)<<11|i>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|o>>>16)+i|0)^i^r)+t[2]-995338651|0)<<23|n>>>9)+o|0,n=((n+=((i=((i+=(n^((r=((r+=(o^(n|~i))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~o))+t[7]+1126891415|0)<<10|i>>>22)+r|0)^((o=((o+=(r^(i|~n))+t[14]-1416354905|0)<<15|o>>>17)+i|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+o|0,n=((n+=((i=((i+=(n^((r=((r+=(o^(n|~i))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~o))+t[3]-1894986606|0)<<10|i>>>22)+r|0)^((o=((o+=(r^(i|~n))+t[10]-1051523|0)<<15|o>>>17)+i|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+o|0,n=((n+=((i=((i+=(n^((r=((r+=(o^(n|~i))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~o))+t[15]-30611744|0)<<10|i>>>22)+r|0)^((o=((o+=(r^(i|~n))+t[6]-1560198380|0)<<15|o>>>17)+i|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+o|0,n=((n+=((i=((i+=(n^((r=((r+=(o^(n|~i))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~o))+t[11]-1120210379|0)<<10|i>>>22)+r|0)^((o=((o+=(r^(i|~n))+t[2]+718787259|0)<<15|o>>>17)+i|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+o|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=o+e[2]|0,e[3]=i+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function o(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function i(e){var t,o,i,a,s,c,u=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)r(l,n(e.substring(t-64,t)));for(o=(e=e.substring(t-64)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<o;t+=1)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(r(l,i),t=0;t<16;t+=1)i[t]=0;return a=(a=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),c=parseInt(a[1],16)||0,i[14]=s,i[15]=c,r(l,i),l}function a(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function c(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function l(){this.reset()}return s(i("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var o,i,a,s,c=this.byteLength,u=t(r,c),l=c;return n!==e&&(l=t(n,c)),u>l?new ArrayBuffer(0):(o=l-u,i=new ArrayBuffer(o),a=new Uint8Array(i),s=new Uint8Array(this,u,o),a.set(s),i)}}(),l.prototype.append=function(e){return this.appendBinary(c(e)),this},l.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,o=this._buff.length;for(t=64;t<=o;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},l.prototype.end=function(e){var t,r,n=this._buff,o=n.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<o;t+=1)i[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(i,o),r=s(this._hash),e&&(r=u(r)),this.reset(),r},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},l.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(e,t){var n,o,i,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(r(this._hash,e),a=0;a<16;a+=1)e[a]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),i=parseInt(n[1],16)||0,e[14]=o,e[15]=i,r(this._hash,e)},l.hash=function(e,t){return l.hashBinary(c(e),t)},l.hashBinary=function(e,t){var r=s(i(e));return t?u(r):r},l.ArrayBuffer=function(){this.reset()},l.ArrayBuffer.prototype.append=function(e){var t,n,i,a,s,c=(n=this._buff.buffer,i=e,a=!0,(s=new Uint8Array(n.byteLength+i.byteLength)).set(new Uint8Array(n)),s.set(new Uint8Array(i),n.byteLength),a?s:s.buffer),u=c.length;for(this._length+=e.byteLength,t=64;t<=u;t+=64)r(this._hash,o(c.subarray(t-64,t)));return this._buff=t-64<u?new Uint8Array(c.buffer.slice(t-64)):new Uint8Array(0),this},l.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,o=n.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<o;t+=1)i[t>>2]|=n[t]<<(t%4<<3);return this._finish(i,o),r=s(this._hash),e&&(r=u(r)),this.reset(),r},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.ArrayBuffer.prototype.getState=function(){var e,t=l.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},l.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,n=e.length,o=new ArrayBuffer(n),i=new Uint8Array(o);for(r=0;r<n;r+=1)i[r]=e.charCodeAt(r);return t?i:o}(e.buff,!0),l.prototype.setState.call(this,e)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(e,t){var n=s(function(e){var t,n,i,a,s,c,u=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)r(l,o(e.subarray(t-64,t)));for(n=(e=t-64<u?e.subarray(t-64):new Uint8Array(0)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)i[t>>2]|=e[t]<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(r(l,i),t=0;t<16;t+=1)i[t]=0;return a=(a=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),c=parseInt(a[1],16)||0,i[14]=s,i[15]=c,r(l,i),l}(new Uint8Array(e)));return t?u(n):n},l},"object"===a(t)?e.exports=i():void 0===(o="function"==typeof(n=i)?n.call(t,r,t,e):n)||(e.exports=o)},437:(e,t,r)=>{e.exports=r(327)},327:function(e,t){!function(r,n){var o={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function i(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function a(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function s(e,t){return e<<t|e>>>32-t}function c(e){return e=a(e^=e>>>16,2246822507),e=a(e^=e>>>13,3266489909),e^=e>>>16}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function l(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function d(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function f(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function h(e,t){return[e[0]^t[0],e[1]^t[1]]}function p(e){return e=h(e,[0,e[0]>>>1]),e=h(e=l(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=h(e=l(e,[3301882366,444984403]),[0,e[0]>>>1])}o.x86.hash32=function(e,t){if(o.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%4,u=e.length-r,l=t,d=0,f=3432918353,h=461845907,p=0;p<u;p+=4)d=a(d=e[p]|e[p+1]<<8|e[p+2]<<16|e[p+3]<<24,f),d=a(d=s(d,15),h),l=a(l=s(l^=d,13),5)+3864292196;switch(d=0,r){case 3:d^=e[p+2]<<16;case 2:d^=e[p+1]<<8;case 1:d=a(d^=e[p],f),l^=d=a(d=s(d,15),h)}return(l=c(l^=e.length))>>>0},o.x86.hash128=function(e,t){if(o.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%16,u=e.length-r,l=t,d=t,f=t,h=t,p=0,y=0,m=0,g=0,v=597399067,b=2869860233,_=951274213,w=2716044179,k=0;k<u;k+=16)p=e[k]|e[k+1]<<8|e[k+2]<<16|e[k+3]<<24,y=e[k+4]|e[k+5]<<8|e[k+6]<<16|e[k+7]<<24,m=e[k+8]|e[k+9]<<8|e[k+10]<<16|e[k+11]<<24,g=e[k+12]|e[k+13]<<8|e[k+14]<<16|e[k+15]<<24,p=s(p=a(p,v),15),l=s(l^=p=a(p,b),19),l=a(l+=d,5)+1444728091,y=s(y=a(y,b),16),d=s(d^=y=a(y,_),17),d=a(d+=f,5)+197830471,m=s(m=a(m,_),17),f=s(f^=m=a(m,w),15),f=a(f+=h,5)+2530024501,g=s(g=a(g,w),18),h=s(h^=g=a(g,v),13),h=a(h+=l,5)+850148119;switch(p=0,y=0,m=0,g=0,r){case 15:g^=e[k+14]<<16;case 14:g^=e[k+13]<<8;case 13:g=a(g^=e[k+12],w),h^=g=a(g=s(g,18),v);case 12:m^=e[k+11]<<24;case 11:m^=e[k+10]<<16;case 10:m^=e[k+9]<<8;case 9:m=a(m^=e[k+8],_),f^=m=a(m=s(m,17),w);case 8:y^=e[k+7]<<24;case 7:y^=e[k+6]<<16;case 6:y^=e[k+5]<<8;case 5:y=a(y^=e[k+4],b),d^=y=a(y=s(y,16),_);case 4:p^=e[k+3]<<24;case 3:p^=e[k+2]<<16;case 2:p^=e[k+1]<<8;case 1:p=a(p^=e[k],v),l^=p=a(p=s(p,15),b)}return l^=e.length,l+=d^=e.length,l+=f^=e.length,d+=l+=h^=e.length,f+=l,h+=l,l=c(l),l+=d=c(d),l+=f=c(f),d+=l+=h=c(h),f+=l,h+=l,("00000000"+(l>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(f>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)},o.x64.hash128=function(e,t){if(o.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%16,a=e.length-r,s=[0,t],c=[0,t],y=[0,0],m=[0,0],g=[2277735313,289559509],v=[1291169091,658871167],b=0;b<a;b+=16)y=[e[b+4]|e[b+5]<<8|e[b+6]<<16|e[b+7]<<24,e[b]|e[b+1]<<8|e[b+2]<<16|e[b+3]<<24],m=[e[b+12]|e[b+13]<<8|e[b+14]<<16|e[b+15]<<24,e[b+8]|e[b+9]<<8|e[b+10]<<16|e[b+11]<<24],y=d(y=l(y,g),31),s=u(s=d(s=h(s,y=l(y,v)),27),c),s=u(l(s,[0,5]),[0,1390208809]),m=d(m=l(m,v),33),c=u(c=d(c=h(c,m=l(m,g)),31),s),c=u(l(c,[0,5]),[0,944331445]);switch(y=[0,0],m=[0,0],r){case 15:m=h(m,f([0,e[b+14]],48));case 14:m=h(m,f([0,e[b+13]],40));case 13:m=h(m,f([0,e[b+12]],32));case 12:m=h(m,f([0,e[b+11]],24));case 11:m=h(m,f([0,e[b+10]],16));case 10:m=h(m,f([0,e[b+9]],8));case 9:m=l(m=h(m,[0,e[b+8]]),v),c=h(c,m=l(m=d(m,33),g));case 8:y=h(y,f([0,e[b+7]],56));case 7:y=h(y,f([0,e[b+6]],48));case 6:y=h(y,f([0,e[b+5]],40));case 5:y=h(y,f([0,e[b+4]],32));case 4:y=h(y,f([0,e[b+3]],24));case 3:y=h(y,f([0,e[b+2]],16));case 2:y=h(y,f([0,e[b+1]],8));case 1:y=l(y=h(y,[0,e[b]]),g),s=h(s,y=l(y=d(y,31),v))}return s=u(s=h(s,[0,e.length]),c=h(c,[0,e.length])),c=u(c,s),s=u(s=p(s),c=p(c)),c=u(c,s),("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)+("00000000"+(c[0]>>>0).toString(16)).slice(-8)+("00000000"+(c[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=o),t.murmurHash3=o}()},946:(e,t,r)=>{e.exports=r(394)},394:(e,t,r)=>{var n=t;function o(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(449),n.BufferWriter=r(818),n.Reader=r(237),n.BufferReader=r(158),n.util=r(610),n.rpc=r(47),n.roots=r(529),n.configure=o,o()},237:(e,t,r)=>{e.exports=c;var n,o=r(610),i=o.LongBits,a=o.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},d=function(){return o.Buffer?function(e){return(c.create=function(e){return o.Buffer.isBuffer(e)?new n(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw s(this,8);return new i(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}c.create=d(),c.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return h(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|h(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw s(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=o.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=d(),n._configure();var t=o.Long?"toLong":"toNumber";o.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},158:(e,t,r)=>{e.exports=i;var n=r(237);(i.prototype=Object.create(n.prototype)).constructor=i;var o=r(610);function i(e){n.call(this,e)}i._configure=function(){o.Buffer&&(i.prototype._slice=o.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},529:e=>{e.exports={}},47:(e,t,r)=>{t.Service=r(595)},595:(e,t,r)=>{e.exports=o;var n=r(610);function o(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(o.prototype=Object.create(n.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function e(t,r,o,i,a){if(!i)throw TypeError("request must be specified");var s=this;if(!a)return n.asPromise(e,s,t,r,o,i);if(s.rpcImpl)try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return s.emit("error",e,t),a(e);if(null!==r){if(!(r instanceof o))try{r=o[s.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return s.emit("error",e,t),a(e)}return s.emit("data",r,t),a(null,r)}s.end(!0)}))}catch(e){return s.emit("error",e,t),void setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},o.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},239:(e,t,r)=>{e.exports=o;var n=r(610);function o(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=o.zero=new o(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var a=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new o(r,n)},o.from=function(e){if("number"==typeof e)return o.fromNumber(e);if(n.isString(e)){if(!n.Long)return o.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new o(e.low>>>0,e.high>>>0):i},o.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;o.fromHash=function(e){return e===a?i:new o((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},o.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},o.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},610:function(e,t,r){var n=t;function o(e,t,r){for(var n=Object.keys(t),o=0;o<n.length;++o)void 0!==e[n[o]]&&r||(e[n[o]]=t[n[o]]);return e}function i(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&o(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(45),n.base64=r(839),n.EventEmitter=r(358),n.float=r(410),n.inquire=r(153),n.utf8=r(447),n.pool=r(390),n.LongBits=r(239),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=o,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},449:(e,t,r)=>{e.exports=d;var n,o=r(610),i=o.LongBits,a=o.base64,s=o.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return o.Buffer?function(){return(d.create=function(){return new n})()}:function(){return new d}};function h(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=f(),d.alloc=function(e){return new o.Array(e)},o.Array!==Array&&(d.alloc=o.pool(d.alloc,o.Array.prototype.subarray)),d.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},p.prototype=Object.create(c.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},d.prototype.bool=function(e){return this._push(h,1,e?1:0)},d.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){var t=i.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(o.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(o.float.writeDoubleLE,8,e)};var g=o.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(h,1,0);if(o.isString(e)){var r=d.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(g,t,e)},d.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(h,1,0)},d.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d._configure=function(e){n=e,d.create=f(),n._configure()}},818:(e,t,r)=>{e.exports=i;var n=r(449);(i.prototype=Object.create(n.prototype)).constructor=i;var o=r(610);function i(){n.call(this)}function a(e,t,r){e.length<40?o.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}i._configure=function(){i.alloc=o._Buffer_allocUnsafe,i.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&"set"===o.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},i.prototype.bytes=function(e){o.isString(e)&&(e=o._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=o.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},i._configure()},797:e=>{e.exports=function e(n,o){var i,a=0,s=(o=o||0,0),c=o,u=n.length;do{if(c>=u||s>49)throw e.bytes=0,new RangeError("Could not decode varint");i=n[c++],a+=s<28?(i&r)<<s:(i&r)*Math.pow(2,s),s+=7}while(i>=t);return e.bytes=c-o,a};var t=128,r=127},877:e=>{e.exports=function e(o,i,a){if(Number.MAX_SAFE_INTEGER&&o>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");i=i||[],a=a||0;var s=a;for(;o>=n;)i[a++]=255&o|t,o/=128;for(;o&r;)i[a++]=255&o|t,o>>>=7;return i[a]=0|o,e.bytes=a-s+1,i};var t=128,r=-128,n=Math.pow(2,31)},203:(e,t,r)=>{e.exports={encode:r(877),decode:r(797),encodingLength:r(867)}},867:e=>{var t=Math.pow(2,7),r=Math.pow(2,14),n=Math.pow(2,21),o=Math.pow(2,28),i=Math.pow(2,35),a=Math.pow(2,42),s=Math.pow(2,49),c=Math.pow(2,56),u=Math.pow(2,63);e.exports=function(e){return e<t?1:e<r?2:e<n?3:e<o?4:e<i?5:e<a?6:e<s?7:e<c?8:e<u?9:10}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__.d(__webpack_exports__,{A:()=>titanStorage});var codec_namespaceObject={};__webpack_require__.r(codec_namespaceObject),__webpack_require__.d(codec_namespaceObject,{DEFAULT_DIRECTORY_MODE:()=>DEFAULT_DIRECTORY_MODE,DEFAULT_FILE_MODE:()=>DEFAULT_FILE_MODE,NodeType:()=>unixfs_NodeType,code:()=>codec_code,createAdvancedFile:()=>createAdvancedFile,createComplexFile:()=>createComplexFile,createDirectoryShard:()=>createDirectoryShard,createEmptyFile:()=>createEmptyFile,createFileChunk:()=>createFileChunk,createFileShard:()=>createFileShard,createFlatDirectory:()=>createFlatDirectory,createRaw:()=>createRaw,createShardedDirectory:()=>createShardedDirectory,createSimpleFile:()=>createSimpleFile,createSymlink:()=>createSymlink,cumulativeContentByteLength:()=>cumulativeContentByteLength,cumulativeDagByteLength:()=>cumulativeDagByteLength,decode:()=>codec_decode,decodeMetadata:()=>decodeMetadata,encode:()=>codec_encode,encodeAdvancedFile:()=>encodeAdvancedFile,encodeComplexFile:()=>encodeComplexFile,encodeDirectory:()=>encodeDirectory,encodeDirectoryMetadata:()=>encodeDirectoryMetadata,encodeFile:()=>encodeFile,encodeFileChunk:()=>encodeFileChunk,encodeFileShard:()=>encodeFileShard,encodeHAMTShard:()=>encodeHAMTShard,encodeLink:()=>codec_encodeLink,encodeMetadata:()=>encodeMetadata,encodeMode:()=>encodeMode,encodeRaw:()=>encodeRaw,encodeSimpleFile:()=>encodeSimpleFile,encodeSymlink:()=>encodeSymlink,filesize:()=>filesize,matchFile:()=>matchFile,name:()=>codec_name});var fixed_namespaceObject={};__webpack_require__.r(fixed_namespaceObject),__webpack_require__.d(fixed_namespaceObject,{context:()=>context,cut:()=>cut,name:()=>fixed_name,type:()=>type,withMaxChunkSize:()=>withMaxChunkSize});var api_namespaceObject={};__webpack_require__.r(api_namespaceObject);var Uint32_namespaceObject={};__webpack_require__.r(Uint32_namespaceObject),__webpack_require__.d(Uint32_namespaceObject,{API:()=>api_namespaceObject,and:()=>and,bitCount:()=>bitCount,empty:()=>Uint32_empty,from:()=>Uint32_from,fromBytes:()=>fromBytes,get:()=>Uint32_get,or:()=>Uint32_or,popcount:()=>popcount,set:()=>Uint32_set,size:()=>size,toBytes:()=>toBytes,unset:()=>unset});var path_Uint32_namespaceObject={};__webpack_require__.r(path_Uint32_namespaceObject),__webpack_require__.d(path_Uint32_namespaceObject,{configure:()=>Uint32_configure,hash32:()=>hash32});var bitfield_Uint8Array_namespaceObject={};__webpack_require__.r(bitfield_Uint8Array_namespaceObject),__webpack_require__.d(bitfield_Uint8Array_namespaceObject,{API:()=>api_namespaceObject,and:()=>Uint8Array_and,empty:()=>Uint8Array_empty,from:()=>Uint8Array_from,fromBytes:()=>Uint8Array_fromBytes,get:()=>Uint8Array_get,or:()=>Uint8Array_or,popcount:()=>Uint8Array_popcount,set:()=>Uint8Array_set,size:()=>Uint8Array_size,toBytes:()=>Uint8Array_toBytes,unset:()=>Uint8Array_unset});var raw_namespaceObject={};__webpack_require__.r(raw_namespaceObject),__webpack_require__.d(raw_namespaceObject,{code:()=>raw_code,decode:()=>raw_decode,encode:()=>raw_encode,name:()=>raw_name});var StatusCodes={SUCCESSFULLY:0,FAILURE:-1,BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,INTERNAL_SERVER_ERROR:-1,SERVICE_UNAVAILABLE:503,InitSdk_ERROR:1001,API_KEY_EMPTY:1002,INVALID_API_KEY:1003,RESOURCE_NOT_AVAILABLE:1004,FILE_NAME_KEY_EMPTY:1005,ID_KEY_EMPTY:1006,PARENT_ID_ERROR:1004,SHARE_ERROE:1007,ASSEST_OBJ_ERROR:1008,INVALID_PASSWORD:1009,FETCH_ERROR:10010,PARENT_ID_INVALID:10011,PAGE_ERROR:10012,PAGESIZE_ERROR:10013,MISSING_FIELDS_ERROR:10014,UPLOAD_FILE_ERROR:10015,AREA_ID_ERROR:10016,Group_ID_ERROR:10017,Asset_Type_ERROR:10018,Dowload_URL_ERROR:10019,Dowload_ERROR:10020,ASSEST_ID_ERROR:10021,Dowload_Type_ERROR:10022,REPORT_ERROR:10023,INVALID_EXPIRE_AT:10024,ASSET_OBJ_ERROR:10025,REQUEST_ERROR:10026,File_Size_ERROR:10027,File_REQUEST_ABOR:10028};const codes=StatusCodes;function handleError(e,t){var r;switch(e){case codes.InitSdk_OK:r="Initialize SDK Success";break;case codes.BAD_REQUEST:r="The request was invalid. Please check your input.";break;case codes.UNAUTHORIZED:r="You are not authorized. Please check your credentials.";break;case codes.FORBIDDEN:r="You do not have permission to access this resource.";break;case codes.NOT_FOUND:r="The requested resource could not be found.";break;case codes.INTERNAL_SERVER_ERROR:r="An error occurred on the server. Please try again later.";break;case codes.SERVICE_UNAVAILABLE:r="The service is currently unavailable. Please try again later.";break;case codes.API_KEY_EMPTY:r="API toekn is required and cannot be empty.";break;case codes.INVALID_API_KEY:r="The provided API Key is invalid.";break;case codes.RESOURCE_NOT_AVAILABLE:r="The requested resource is not available.";break;case codes.ID_KEY_EMPTY:r="ID is required but was not provided.";break;case codes.ASSET_OBJ_ERROR:r="Invalid options provided.";break;case codes.REQUEST_ERROR:r="Failed to retrieve asset group information.";break;case codes.FILE_NAME_KEY_EMPTY:r="Name is required but was not provided.";break;case codes.PARENT_ID_ERROR:r="Parent ID is required but was incorrect.";break;case codes.SHARE_ERROE:r="The file cannot be shared.";break;case codes.ASSEST_OBJ_ERROR:r="assetDetail must be an object.";break;case codes.PARENT_ID_INVALID:r="Invalid 'parent' parameter. It should be a non-negative number.";break;case codes.PAGE_ERROR:r="Invalid 'page' parameter. It should be a positive number.";break;case codes.PAGESIZE_ERROR:r="Invalid 'pageSize' parameter. It should be a non-negative number.";break;case codes.MISSING_FIELDS_ERROR:r="Missing required fields in assetDetail";break;case codes.INVALID_PASSWORD:r="Invalid shortPass format. It should be a 6-character alphanumeric string.";break;case codes.AREA_ID_ERROR:r="area_id should be an array.";break;case codes.Group_ID_ERROR:r="group_id should be a non-negative integer.";break;case codes.Asset_Type_ERROR:r="asset_type should be 0 or 1.";break;case codes.Sdk_OK:r="TitanSDK initialized successfully";break;case codes.InitSdk_ERROR:r="Failed to initialize TitanSDK";break;case codes.Dowload_URL_ERROR:r="No available download address";break;case codes.Dowload_Type_ERROR:r="Download type not found";break;case codes.SUCCESSFULLY:r="Success";break;case codes.FAILURE:r="Failure";break;default:r="An unknown error occurred."}return{code:e,msg:t||r}}function log(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};JSON.parse(localStorage.getItem("titanOptions")).debug&&(Object.keys(t).length>0?console.log(e,t):console.log(e))}function onHandleData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.code,r=e.msg,n=void 0===r?"":r,o=e.data,i=void 0===o?{}:o,a={code:t,msg:n};return n||(a=handleError(t,n)),{code:a.code,msg:a.msg,data:i||{}}}var _excluded=["code","msg","data"],_excluded2=["code","msg","data"];function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;r[n]=e[n]}return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var Http=function(){return _createClass((function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.token=t,this.url=r,this.debug=n,this.url||(this.url="https://api-test1.container1.titannet.io"),t&&""!==t.trim()||log(codes.API_KEY_EMPTY,"")}),[{key:"checkLanguage",value:function(){var e=navigator.language||navigator.userLanguage,t=localStorage.getItem("ttStorageLanguage");return t||(e.includes("zh")?"cn":e.includes("en")?"en":"")}},{key:"updateToken",value:function(e){return e&&""!==e.trim()?(this.token=e,onHandleData({code:codes.SUCCESSFULLY})):onHandleData({code:codes.FAILURE})}},{key:"updateLanguage",value:function(e){return e&&""!==e.trim()?(localStorage.setItem("ttStorageLanguage",e),onHandleData({code:codes.SUCCESSFULLY})):onHandleData({code:codes.FAILURE})}},{key:"getData",value:function(e){var t="".concat(this.url).concat(e);if(!this.token||""===this.token.trim())return onHandleData({code:codes.API_KEY_EMPTY});log("Fetching data from URL:",t);var r={"Content-Type":"application/json",lang:this.checkLanguage()};return"token"!=this.token&&(r.JwtAuthorization="Bearer "+this.token),fetch(t,{method:"GET",headers:r}).then((function(e){return e.ok?e.json():e.text().then((function(t){return onHandleData({code:e.status,msg:null!=t?t:""})}))})).then((function(e){log("fetched successfully:",e);var t=e.code,r=e.msg,n=e.data,o=_objectWithoutProperties(e,_excluded);return onHandleData({code:t,msg:null!=r?r:"",data:_objectSpread(_objectSpread({},n),o)})})).catch((function(e){return onHandleData({code:codes.FETCH_ERROR,msg:e})}))}},{key:"postData",value:function(e,t){var r="".concat(this.url).concat(e);if(!this.token||""===this.token.trim())return onHandleData({code:codes.API_KEY_EMPTY});log("Posting data to URL:",r);var n={"Content-Type":"application/json",lang:this.checkLanguage()};return"token"!=this.token&&(n.JwtAuthorization="Bearer "+this.token),fetch(r,{method:"POST",headers:n,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():e.text().then((function(t){var r="Error ".concat(e.status,": ").concat(t),n=onHandleData({code:e.status,msg:r});return Promise.reject(n)}))})).then((function(e){log("Data posted successfully:",e);var t=e.code,r=e.msg,n=e.data,o=_objectWithoutProperties(e,_excluded2);return onHandleData({code:t,msg:null!=r?r:"",data:_objectSpread(_objectSpread({},Array.isArray(n)?{List:n}:n),o)})})).catch((function(e){return log("Data posted error:",e),onHandleData({code:codes.FETCH_ERROR,msg:e})}))}},{key:"uploadFile",value:function(e,t,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return new Promise((function(s,c){var u=new XMLHttpRequest,l="".concat(e);if(!n.token||""===n.token.trim())return onHandleData({code:codes.API_KEY_EMPTY});var d=0;u.open("POST",l,!0),u.setRequestHeader("JwtAuthorization","Bearer "+n.token),u.setRequestHeader("Authorization","Bearer "+t),u.upload.onprogress=function(e){if(e.lengthComputable&&i){d=e.total;var t=e.loaded/e.total*100;i(e.loaded,e.total,t)}},u.onload=function(){if(u.status>=200&&u.status<300){var e=JSON.parse(u.responseText);log("File uploaded successfully:",e),i&&i(d,d,100),s(e)}else log("File uploaded:",u.status),c(onHandleData({code:u.status,msg:u.responseText}))},u.onerror=function(){var e="File upload failed: ".concat(u.statusText||"Handle network errors");c(onHandleData({code:codes.FETCH_ERROR,msg:e}))},a.addEventListener("abort",(function(){u.abort(),c(onHandleData({code:-200,msg:"Handle request abortion",data:{abort:!0}}))}));var f=new FormData;for(var h in f.append("file",r),o)o.hasOwnProperty(h)&&f.append(h,o[h]);u.send(f)}))}}])}(),Validator={validateApiKey:function(e){if(!e||""===e.trim())return onHandleData({code:codes.API_KEY_EMPTY})},validateGroupName:function(e){if(!e||""===e.trim())return onHandleData({code:codes.FILE_NAME_KEY_EMPTY,msg:"Group name cannot be empty."})},validateAssetCid:function(e){if(!e||""===e.trim())return onHandleData({code:codes.ASSEST_ID_ERROR,msg:"AssetCid cannot be empty."})},validateAssetId:function(e){if(!e||""===e.trim())return onHandleData({code:codes.ASSEST_ID_ERROR,msg:"Asset ID is required."})},validateAreaId:function(e){if(!Array.isArray(e))return onHandleData({code:codes.AREA_ID_ERROR,msg:"Asset_ID should be an array."})},validateGroupId:function(e){if(!Number.isInteger(e))return onHandleData({code:codes.Group_ID_ERROR,msg:"group_id should be a non-negative intege."})},validateAssetType:function(e){if(0!==e&&1!==e)return onHandleData({code:codes.Asset_Type_ERROR,msg:"asset_type should be 0 or 1."})},validateAssetFile:function(e){if(e>104857600)return onHandleData({code:codes.File_Size_ERROR,msg:"file size should not exceed 100MB."})},validateParentId:function(e){if("number"!=typeof e||e<0)return onHandleData({code:codes.PARENT_ID_INVALID,msg:"Parent ID is invalid."})},validatePage:function(e){if("number"!=typeof e||e<=0)return onHandleData({code:codes.PAGE_ERROR,msg:"Page number is invalid."})},validatePageSize:function(e){if("number"!=typeof e||e<=0)return onHandleData({code:codes.PAGESIZE_ERROR,msg:"Page size is invalid."})},validateShortPass:function(e){if(e){if(!/^[a-zA-Z0-9]{6}$/.test(e))return onHandleData({code:codes.INVALID_PASSWORD,msg:"hort password is invalid. It must be 6 characters long and can only contain letters and numbers."})}},validateExpireAt:function(e){if(e&&!(Number.isInteger(e)&&e>0))return onHandleData({code:codes.INVALID_EXPIRE_AT,msg:"expireAt must be a positive integer"})},validateShareStatus:function(e){if(![0,1].includes(e))return onHandleData({code:codes.SHARE_ERROE,msg:"Share status is invalid"})},validateUploadOptions:function(e,t,r,n){var o=[{fn:Validator.validateAreaId,value:t},{fn:Validator.validateGroupId,value:r},{fn:Validator.validateAssetType,value:n}];if(e.size<=0)return onHandleData({code:codes.File_Size_ERROR,msg:"File size must be greater than 0"});if(-1===r&&Validator.validateAssetFile(e.size))return Validator.validateAssetFile(e.size);for(var i=0,a=o;i<a.length;i++){var s=a[i],c=(0,s.fn)(s.value);if(c)return c}return null}};function httpService_typeof(e){return httpService_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},httpService_typeof(e)}function httpService_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function httpService_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?httpService_ownKeys(Object(r),!0).forEach((function(t){httpService_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):httpService_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function httpService_defineProperty(e,t,r){return(t=httpService_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _regeneratorRuntime(){_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==httpService_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(httpService_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function httpService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function httpService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,httpService_toPropertyKey(n.key),n)}}function httpService_createClass(e,t,r){return t&&httpService_defineProperties(e.prototype,t),r&&httpService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function httpService_toPropertyKey(e){var t=httpService_toPrimitive(e,"string");return"symbol"==httpService_typeof(t)?t:t+""}function httpService_toPrimitive(e,t){if("object"!=httpService_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=httpService_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var HttpService=function(){return httpService_createClass((function e(t){httpService_classCallCheck(this,e),this.Http=t}),[{key:"getFileUploadURL",value:(g=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,o,i,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.isLoggedIn,n=t.assetData,o=t.areaIds,!r){e.next=9;break}return i="/api/v1/storage/get_upload_info?t="+(new Date).getTime()+"&need_trace=true&md5="+n,o&&o.length>0&&(a=o.map((function(e){return"area_id=".concat(encodeURIComponent(e))})).join("&"),i+="&".concat(a)),e.next=6,this.Http.getData(i);case 6:case 13:return e.abrupt("return",e.sent);case 9:return i="/api/v1/storage/temp_file/get_upload_file?t="+(new Date).getTime()+"&need_trace=true",o&&o.length>0&&(s=o.map((function(e){return"area_id=".concat(encodeURIComponent(e))})).join("&"),i+="&".concat(s)),e.next=13,this.Http.getData(i);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"postFileUpload",value:(m=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.isLoggedIn,n=t.assetData,!r){e.next=8;break}return o="/api/v1/storage/create_asset",e.next=5,this.Http.postData(o,n);case 5:case 11:return e.abrupt("return",e.sent);case 8:return o="/api/v1/storage/temp_file/upload",e.next=11,this.Http.postData(o,n);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getFileDownURL",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,o,i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.assetCid,n=t.userId,o=t.areaId,i=t.hasTempFile,a=i?"/api/v1/storage/temp_file/download/".concat(r):n?"/api/v1/storage/open_asset?user_id=".concat(n,"&asset_cid=").concat(r):"/api/v1/storage/share_asset?asset_cid=".concat(r),null!=o&&""!=o&&(a+="&area_id=".concat(encodeURIComponent(o))),e.next=5,this.Http.getData(a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getAssetGroupInfo",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=r.length>0&&void 0!==r[0]?r[0]:{cId:-1,groupId:-1}).cId){e.next=7;break}return e.next=4,this.Http.getData("/api/v1/storage/get_asset_group_info?cid=".concat(t.cId));case 4:case 10:return e.abrupt("return",e.sent);case 7:if(!t.groupId){e.next=11;break}return e.next=10,this.Http.getData("/api/v1/storage/get_asset_group_info?groupid=".concat(t.groupId));case 11:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"getAreaIdList",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.getData("/api/v1/storage/get_area_id");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"createGroup",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.getData("/api/v1/storage/create_group?name=".concat(encodeURIComponent(t),"&parent=").concat(r));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"onAssetGroupList",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.getData("/api/v1/storage/get_asset_group_list?page=".concat(t,"&parent=").concat(r,"&page_size=").concat(n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return d.apply(this,arguments)})},{key:"renameGroup",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={group_id:(t=n.length>0&&void 0!==n[0]?n[0]:{groupId:-1,name:""}).groupId,new_name:t.name},e.next=4,this.Http.postData("/api/v1/storage/rename_group",r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"renameAsset",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={asset_cid:(t=n.length>0&&void 0!==n[0]?n[0]:{assetId:-1,name:""}).assetId,new_name:t.name},e.next=4,this.Http.postData("/api/v1/storage/rename_group",r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"deleteGroup",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{groupId:-1},e.next=3,this.Http.getData("/api/v1/storage/delete_group?group_id=".concat(t.groupId));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"deleteAsset",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,o=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/api/v1/storage/delete_asset?asset_cid=".concat((t=o.length>0&&void 0!==o[0]?o[0]:{assetId:-1,areaId:[]}).assetId),t.areaId&&t.areaId.length>0&&(n=t.areaId.map((function(e){return"area_id=".concat(encodeURIComponent(e))})).join("&"),r+="&".concat(n)),e.next=5,this.Http.getData(r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"userInfo",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.Http.getData("/api/v1/storage/get_storage_size");case 3:return t=e.sent,e.next=7,this.Http.getData("/api/v1/storage/get_vip_info");case 7:return r=e.sent,e.next=11,this.Http.getData("/api/v1/storage/get_asset_count");case 11:return n=e.sent,o=httpService_objectSpread(httpService_objectSpread(httpService_objectSpread({},t.data),r.data),n.data),e.abrupt("return",{code:0,data:o});case 14:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"postReport",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.postData("/api/v1/storage/transfer/report",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"createLink",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.getData("/api/v1/storage/create_link"+t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"shareStatusSet",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.getData("/api/v1/storage/share_status_set"+t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"shareLinkInfo",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.getData("/api/v1/storage/share_link_info"+t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"shareLinkUpdate",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.postData("/api/v1/storage/share_link_update",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"uploadFile",value:(e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,o,i){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Http.uploadFile(t,r,n,null,i,o);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(t,r,n,o,i){return e.apply(this,arguments)})}]);var e,t,r,n,o,i,a,s,c,u,l,d,f,h,p,y,m,g}();const httpService=HttpService;function report_typeof(e){return report_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},report_typeof(e)}function report_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function report_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?report_ownKeys(Object(r),!0).forEach((function(t){report_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):report_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function report_defineProperty(e,t,r){return(t=report_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function report_regeneratorRuntime(){report_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==report_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(report_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function report_asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function report_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){report_asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){report_asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function report_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function report_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,report_toPropertyKey(n.key),n)}}function report_createClass(e,t,r){return t&&report_defineProperties(e.prototype,t),r&&report_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function report_toPropertyKey(e){var t=report_toPrimitive(e,"string");return"symbol"==report_typeof(t)?t:t+""}function report_toPrimitive(e,t){if("object"!=report_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=report_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var Report=function(){return report_createClass((function e(t){report_classCallCheck(this,e),this.httpService=t}),[{key:"postReport",value:(e=report_asyncToGenerator(report_regeneratorRuntime().mark((function e(t,r,n,o,i,a,s,c,u){var l,d;return report_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={trace_id:null!=t?t:"",cid:r,node_id:n,rate:o,cost_ms:i,total_size:a,state:s,transfer_type:c,log:u},e.next=4,this.httpService.postReport(l);case 4:if(0===(d=e.sent).code){e.next=7;break}return e.abrupt("return",onHandleData({code:d.code,msg:"Failed to report"}));case 7:return e.abrupt("return",d);case 10:return e.prev=10,e.t0=e.catch(0),console.log(333,e.t0),e.abrupt("return",onHandleData({code:codes.REPORT_ERROR,msg:"Failed to report: "+e.t0}));case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(t,r,n,o,i,a,s,c,u){return e.apply(this,arguments)})},{key:"creatReportData",value:function(e,t){if(0!=e.length){var r=e,n=r.map((function(e){return e.nodeId.toLowerCase()})).join(", "),o=r.reduce((function(e,t){return report_objectSpread(report_objectSpread({},e),t.log)}),{}),i=0===Object.keys(o).length?null:JSON.stringify(o),a=r[0].traceId,s=r[0].cId,c=n,u=r[0].transferRate,l=r[0].elapsedTime,d=r[0].size,f=r[0].status,h=t,p=i;this.postReport(a,s,c,u,l,d,f,h,p)}}}]);var e}();const report=Report;var spark_md5=__webpack_require__(232),spark_md5_default=__webpack_require__.n(spark_md5);function uploadLoader_typeof(e){return uploadLoader_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uploadLoader_typeof(e)}function uploadLoader_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function uploadLoader_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?uploadLoader_ownKeys(Object(r),!0).forEach((function(t){uploadLoader_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uploadLoader_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function uploadLoader_defineProperty(e,t,r){return(t=uploadLoader_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uploadLoader_regeneratorRuntime(){uploadLoader_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==uploadLoader_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(uploadLoader_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function uploadLoader_asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function uploadLoader_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){uploadLoader_asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){uploadLoader_asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function uploadLoader_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uploadLoader_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,uploadLoader_toPropertyKey(n.key),n)}}function uploadLoader_createClass(e,t,r){return t&&uploadLoader_defineProperties(e.prototype,t),r&&uploadLoader_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function uploadLoader_toPropertyKey(e){var t=uploadLoader_toPrimitive(e,"string");return"symbol"==uploadLoader_typeof(t)?t:t+""}function uploadLoader_toPrimitive(e,t){if("object"!=uploadLoader_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=uploadLoader_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var UploadLoader=function(){return uploadLoader_createClass((function e(t){uploadLoader_classCallCheck(this,e),this.httpService=t,this.report=new report(this.httpService),this.abortController=null}),[{key:"uploadFile",value:(i=uploadLoader_asyncToGenerator(uploadLoader_regeneratorRuntime().mark((function e(t,r,n,o,i){var a,s,c,u;return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.httpService.uploadFile(t,r,n,o,i);case 3:if(0===(a=e.sent).code){e.next=6;break}return e.abrupt("return",onHandleData({code:a.code,msg:"Failed to upload file: "+a.msg,data:null!==(s=a.data)&&void 0!==s?s:{}}));case 6:return e.abrupt("return",a);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",onHandleData({code:e.t0.code,msg:null!==(c="Failed to upload file: "+e.t0.msg)&&void 0!==c?c:"",data:null!==(u=e.t0.data)&&void 0!==u?u:{}}));case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,t,r,n,o){return i.apply(this,arguments)})},{key:"onFileUpload",value:(o=uploadLoader_asyncToGenerator(uploadLoader_regeneratorRuntime().mark((function e(t,r,n){var o,i,a,s,c,u,l,d,f;return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.areaId,i=void 0===o?[]:o,a=r.groupId,s=void 0===a?0:a,r.assetType,c=r.extraId,u=void 0===c?"":c,l=r.retryCount,d=void 0===l?3:l,e.next=3,this.handleFileUpload(t,i,s,u,d,n);case 3:return f=e.sent,e.abrupt("return",f);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return o.apply(this,arguments)})},{key:"handleFileUpload",value:(n=uploadLoader_asyncToGenerator(uploadLoader_regeneratorRuntime().mark((function e(t,r,n,o){var i,a,s,c,u,l,d,f,h,p,y,m,g,v,b,_=this,w=arguments;return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=w.length>4&&void 0!==w[4]?w[4]:3,a=w.length>5?w[5]:void 0,s=-1===n,c=[],u=Date.now(),e.prev=6,e.next=9,this.calculateFileHash(t);case 9:if(0==(l=e.sent).code){e.next=12;break}return e.abrupt("return",l);case 12:return d=l.data.hash,e.next=15,this.httpService.getFileUploadURL({isLoggedIn:!s,areaIds:r,assetData:d});case 15:if(0==(f=e.sent).code){e.next=18;break}return e.abrupt("return",f);case 18:if(!f.data.AlreadyExists){e.next=23;break}return e.next=21,this.onCreateAsset(s,t,r,n,o,d,{cid:f.data.CID,nodeId:""});case 21:return h=e.sent,e.abrupt("return",h);case 23:return p=f.data,y=function(){var e=uploadLoader_asyncToGenerator(uploadLoader_regeneratorRuntime().mark((function e(r){var n,o,i,s,l,d,f,h;return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.abortController=new AbortController,i=r.NodeID.replace(/^c_/,""),e.next=4,_.uploadFile(r.UploadURL,r.Token,t,_.abortController.signal,(function(e,t,r){a&&a(e,t,r)}));case 4:return s=e.sent,l=null!==(n=p.TraceID)&&void 0!==n?n:"",d=Date.now(),f=d-u,h=Math.floor(t.size/f*1e3),c.push(uploadLoader_objectSpread({status:0===s.code?1:2,msg:s.msg,elapsedTime:f,transferRate:h,size:t.size,traceId:l,nodeId:i,cId:null!==(o=s.cid)&&void 0!==o?o:"",log:0===s.code?"":uploadLoader_defineProperty({},i,s.msg)},s)),s.nodeId=r.NodeID,s.code,e.abrupt("return",s);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=27,this.uploadWithRetry(p.List,y,i,a);case 27:if(0!==(m=e.sent).code){e.next=34;break}return e.next=31,this.onCreateAsset(s,t,r,n,o,d,m);case 31:g=e.sent,e.next=35;break;case 34:g={code:-1,msg:null!==(v=m.msg)&&void 0!==v?v:"Upload addresses failed.",data:null!==(b=m.data)&&void 0!==b?b:{}};case 35:return this.report.creatReportData(c,"upload"),e.abrupt("return",g);case 39:return e.prev=39,e.t0=e.catch(6),e.abrupt("return",onHandleData({code:codes.FAILURE,msg:e.t0}));case 42:case"end":return e.stop()}}),e,this,[[6,39]])}))),function(e,t,r,o){return n.apply(this,arguments)})},{key:"uploadWithRetry",value:(r=uploadLoader_asyncToGenerator(uploadLoader_regeneratorRuntime().mark((function e(t,r,n,o){var i;return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(){var e=uploadLoader_asyncToGenerator(uploadLoader_regeneratorRuntime().mark((function e(o){var a,s,c;return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o>=t.length)){e.next=2;break}return e.abrupt("return",{code:codes.UPLOAD_FILE_ERROR,msg:"upload addresses failed."});case 2:a=uploadLoader_regeneratorRuntime().mark((function e(n){var i;return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r(t[o]);case 3:if(log("uploadWithRetry",i=e.sent),0!==i.code&&-200!=i.code){e.next=7;break}return e.abrupt("return",{v:i});case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(0),e.next=13,new Promise((function(e){return setTimeout(e,1e3*Math.pow(2,n))}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})),c=0;case 4:if(!(c<n)){e.next=12;break}return e.delegateYield(a(c),"t0",6);case 6:if(!(s=e.t0)){e.next=9;break}return e.abrupt("return",s.v);case 9:c++,e.next=4;break;case 12:return e.abrupt("return",i(o+1));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",i(0));case 2:case"end":return e.stop()}}),e)}))),function(e,t,n,o){return r.apply(this,arguments)})},{key:"calculateFileHash",value:(t=uploadLoader_asyncToGenerator(uploadLoader_regeneratorRuntime().mark((function e(t){return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var n=new FileReader;n.readAsArrayBuffer(t),n.onload=function(){var t=spark_md5_default().ArrayBuffer.hash(n.result);e({code:0,data:{hash:t}})},n.onerror=function(e){r({code:codes.FAILURE,msg:e})}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"onCreateAsset",value:(e=uploadLoader_asyncToGenerator(uploadLoader_regeneratorRuntime().mark((function e(t,r,n,o,i,a,s){var c,u;return uploadLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c={asset_name:r.name,asset_type:"file",asset_size:r.size,asset_cid:s.cid,group_id:o,node_id:s.nodeId,extra_id:i},t){e.next=7;break}return e.next=4,this.httpService.postFileUpload({isLoggedIn:!0,assetData:uploadLoader_objectSpread(uploadLoader_objectSpread({},c),{},{md5:a,area_id:n})});case 4:u=e.sent,e.next=10;break;case 7:return e.next=9,this.httpService.postFileUpload({isLoggedIn:!1,assetData:uploadLoader_objectSpread(uploadLoader_objectSpread({},c),{},{area_ids:n})});case 9:u=e.sent;case 10:if(!u.data.err||1017!==u.data.err){e.next=14;break}return e.abrupt("return",onHandleData({code:0,data:{cid:s.cid,isAlreadyExist:!0,url:u.data.assetDirectUrl}}));case 14:return e.abrupt("return",onHandleData({code:u.code,data:{cid:s.cid},msg:"Upload success"}));case 15:case"end":return e.stop()}}),e,this)}))),function(t,r,n,o,i,a,s){return e.apply(this,arguments)})},{key:"cancelUpload",value:function(){this.abortController&&(this.abortController.abort(),this.abortController=null)}}]);var e,t,r,n,o,i}();const uploadLoader=UploadLoader,empty=new Uint8Array(0);function toHex(e){return e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),"")}function fromHex(e){const t=e.match(/../g);return null!=t?new Uint8Array(t.map((e=>parseInt(e,16)))):empty}function equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function coerce(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function isBinary(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function fromString(e){return(new TextEncoder).encode(e)}function bytes_toString(e){return(new TextDecoder).decode(e)}function base(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),a=i.charCodeAt(0);if(255!==r[a])throw new TypeError(i+" is ambiguous");r[a]=o}var s=e.length,c=e.charAt(0),u=Math.log(s)/Math.log(256),l=Math.log(256)/Math.log(s);function d(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,o=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*u+1>>>0,a=new Uint8Array(i);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var d=0,f=i-1;(0!==l||d<o)&&-1!==f;f--,d++)l+=s*a[f]>>>0,a[f]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");o=d,t++}if(" "!==e[t]){for(var h=i-o;h!==i&&0===a[h];)h++;for(var p=new Uint8Array(n+(i-h)),y=n;h!==i;)p[y++]=a[h++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var a=(i-o)*l+1>>>0,u=new Uint8Array(a);o!==i;){for(var d=t[o],f=0,h=a-1;(0!==d||f<n)&&-1!==h;h--,f++)d+=256*u[h]>>>0,u[h]=d%s>>>0,d=d/s>>>0;if(0!==d)throw new Error("Non-zero carry");n=f,o++}for(var p=a-n;p!==a&&0===u[p];)p++;for(var y=c.repeat(r);p<a;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:d,decode:function(e){var r=d(e);if(r)return r;throw new Error(`Non-${t} character`)}}}var src=base,_brrp__multiformats_scope_baseX=src;const base_x=_brrp__multiformats_scope_baseX;class Encoder{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Decoder{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){this.name=e,this.prefix=t;const n=t.codePointAt(0);if(void 0===n)throw new Error("Invalid prefix character");this.prefixCodePoint=n,this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return or(this,e)}}class ComposedDecoder{decoders;constructor(e){this.decoders=e}or(e){return or(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(null!=r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function or(e,t){return new ComposedDecoder({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class Codec{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Encoder(e,t,r),this.decoder=new Decoder(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function from({name:e,prefix:t,encode:r,decode:n}){return new Codec(e,t,r,n)}function baseX({name:e,prefix:t,alphabet:r}){const{encode:n,decode:o}=base_x(r,e);return from({prefix:t,name:e,encode:n,decode:e=>coerce(o(e))})}function decode(e,t,r,n){const o={};for(let e=0;e<t.length;++e)o[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const a=new Uint8Array(i*r/8|0);let s=0,c=0,u=0;for(let t=0;t<i;++t){const i=o[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,s+=r,s>=8&&(s-=8,a[u++]=255&c>>s)}if(s>=r||255&c<<8-s)throw new SyntaxError("Unexpected end of data");return a}function encode(e,t,r){const n="="===t[t.length-1],o=(1<<r)-1;let i="",a=0,s=0;for(let n=0;n<e.length;++n)for(s=s<<8|e[n],a+=8;a>r;)a-=r,i+=t[o&s>>a];if(0!==a&&(i+=t[o&s<<r-a]),n)for(;i.length*r&7;)i+="=";return i}function rfc4648({name:e,prefix:t,bitsPerChar:r,alphabet:n}){return from({prefix:t,name:e,encode:e=>encode(e,n,r),decode:t=>decode(t,n,r,e)})}const base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var encode_1=varint_encode,MSB=128,REST=127,MSBALL=~REST,INT=Math.pow(2,31);function varint_encode(e,t,r){t=t||[];for(var n=r=r||0;e>=INT;)t[r++]=255&e|MSB,e/=128;for(;e&MSBALL;)t[r++]=255&e|MSB,e>>>=7;return t[r]=0|e,varint_encode.bytes=r-n+1,t}var varint_decode=read,MSB$1=128,REST$1=127;function read(e,t){var r,n=0,o=0,i=t=t||0,a=e.length;do{if(i>=a)throw read.bytes=0,new RangeError("Could not decode varint");r=e[i++],n+=o<28?(r&REST$1)<<o:(r&REST$1)*Math.pow(2,o),o+=7}while(r>=MSB$1);return read.bytes=i-t,n}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),varint_length=function(e){return e<N1?1:e<N2?2:e<N3?3:e<N4?4:e<N5?5:e<N6?6:e<N7?7:e<N8?8:e<N9?9:10},varint={encode:encode_1,decode:varint_decode,encodingLength:varint_length},_brrp_varint=varint;const vendor_varint=_brrp_varint;function src_varint_decode(e,t=0){return[vendor_varint.decode(e,t),vendor_varint.decode.bytes]}function encodeTo(e,t,r=0){return vendor_varint.encode(e,t,r),t}function encodingLength(e){return vendor_varint.encodingLength(e)}function create(e,t){const r=t.byteLength,n=encodingLength(e),o=n+encodingLength(r),i=new Uint8Array(o+r);return encodeTo(e,i,0),encodeTo(r,i,n),i.set(t,o),new Digest(e,r,t,i)}function digest_decode(e){const t=coerce(e),[r,n]=src_varint_decode(t),[o,i]=src_varint_decode(t.subarray(n)),a=t.subarray(n+i);if(a.byteLength!==o)throw new Error("Incorrect length");return new Digest(r,o,a,t)}function digest_equals(e,t){if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&equals(e.bytes,r.bytes)}}class Digest{code;size;digest;bytes;constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}function hasCode(e,t){return e.code===t}function format(e,t){const{bytes:r,version:n}=e;return 0===n?toStringV0(r,baseCache(e),t??base58btc.encoder):toStringV1(r,baseCache(e),t??base32.encoder)}function toJSON(e){return{"/":format(e)}}function fromJSON(e){return cid_CID.parse(e["/"])}const cache=new WeakMap;function baseCache(e){const t=cache.get(e);if(null==t){const t=new Map;return cache.set(e,t),t}return t}class cid_CID{code;version;multihash;bytes;"/";constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return cid_CID.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=create(e,t);return cid_CID.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return cid_CID.equals(this,e)}static equals(e,t){const r=t;return null!=r&&e.code===r.code&&e.version===r.version&&digest_equals(e.multihash,r.multihash)}toString(e){return format(this,e)}toJSON(){return{"/":format(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof cid_CID)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:o}=t;return new cid_CID(e,r,n,o??encodeCID(e,r,n.bytes))}if(!0===t[cidSymbol]){const{version:e,multihash:r,code:n}=t,o=digest_decode(r);return cid_CID.create(e,n,o)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new cid_CID(e,t,r,r.bytes);case 1:{const n=encodeCID(e,t,r.bytes);return new cid_CID(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return cid_CID.create(0,DAG_PB_CODE,e)}static createV1(e,t){return cid_CID.create(1,e,t)}static decode(e){const[t,r]=cid_CID.decodeFirst(e);if(0!==r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=cid_CID.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const o=n.subarray(t.multihashSize-t.digestSize),i=new Digest(t.multihashCode,t.digestSize,o,n);return[0===t.version?cid_CID.createV0(i):cid_CID.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=src_varint_decode(e.subarray(t));return t+=n,r};let n=r(),o=DAG_PB_CODE;if(18===n?(n=0,t=0):o=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,a=r(),s=r(),c=t+s;return{version:n,codec:o,multihashCode:a,digestSize:s,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=parseCIDtoBytes(e,t),o=cid_CID.decode(n);if(0===o.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return baseCache(o).set(r,e),o}}function parseCIDtoBytes(e,t){switch(e[0]){case"Q":{const r=t??base58btc;return[base58btc.prefix,r.decode(`${base58btc.prefix}${e}`)]}case base58btc.prefix:{const r=t??base58btc;return[base58btc.prefix,r.decode(e)]}case base32.prefix:{const r=t??base32;return[base32.prefix,r.decode(e)]}case base36.prefix:{const r=t??base36;return[base36.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}function toStringV0(e,t,r){const{prefix:n}=r;if(n!==base58btc.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const o=t.get(n);if(null==o){const o=r.encode(e).slice(1);return t.set(n,o),o}return o}function toStringV1(e,t,r){const{prefix:n}=r,o=t.get(n);if(null==o){const o=r.encode(e);return t.set(n,o),o}return o}const DAG_PB_CODE=112,SHA_256_CODE=18;function encodeCID(e,t,r){const n=encodingLength(e),o=n+encodingLength(t),i=new Uint8Array(o+r.byteLength);return encodeTo(e,i,0),encodeTo(t,i,n),i.set(r,o),i}const cidSymbol=Symbol.for("@ipld/js-cid/CID"),textDecoder=new TextDecoder;function decodeVarint(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const o=e[t++];if(r+=n<28?(127&o)<<n:(127&o)*2**n,o<128)break}return[r,t]}function decodeBytes(e,t){let r;[r,t]=decodeVarint(e,t);const n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function decodeKey(e,t){let r;return[r,t]=decodeVarint(e,t),[7&r,r>>3,t]}function decodeLink(e){const t={},r=e.length;let n=0;for(;n<r;){let r,o;if([r,o,n]=decodeKey(e,n),1===o){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=decodeBytes(e,n)}else if(2===o){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=decodeBytes(e,n),t.Name=textDecoder.decode(o)}else{if(3!==o)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=decodeVarint(e,n)}}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}function decodeNode(e){const t=e.length;let r,n,o=0,i=!1;for(;o<t;){let t,a;if([t,a,o]=decodeKey(e,o),2!==t)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${t}`);if(1===a){if(n)throw new Error("protobuf: (PBNode) duplicate Data section");[n,o]=decodeBytes(e,o),r&&(i=!0)}else{if(2!==a)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${a}`);{if(i)throw new Error("protobuf: (PBNode) duplicate Links section");let t;r||(r=[]),[t,o]=decodeBytes(e,o),r.push(decodeLink(t))}}}if(o>t)throw new Error("protobuf: (PBNode) unexpected end of data");const a={};return n&&(a.Data=n),a.Links=r||[],a}const textEncoder=new TextEncoder,maxInt32=2**32,maxUInt32=2**31;function encodeLink(e,t){let r=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");r=encodeVarint(t,r,e.Tsize)-1,t[r]=24}if("string"==typeof e.Name){const n=textEncoder.encode(e.Name);r-=n.length,t.set(n,r),r=encodeVarint(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=encodeVarint(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function encodeNode(e){const t=sizeNode(e),r=new Uint8Array(t);let n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=encodeVarint(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let t=e.Links.length-1;t>=0;t--){const o=encodeLink(e.Links[t],r.subarray(0,n));n-=o,n=encodeVarint(r,n,o)-1,r[n]=18}return r}function sizeLink(e){let t=0;if(e.Hash){const r=e.Hash.length;t+=1+r+sov(r)}if("string"==typeof e.Name){const r=textEncoder.encode(e.Name).length;t+=1+r+sov(r)}return"number"==typeof e.Tsize&&(t+=1+sov(e.Tsize)),t}function sizeNode(e){let t=0;if(e.Data){const r=e.Data.length;t+=1+r+sov(r)}if(e.Links)for(const r of e.Links){const e=sizeLink(r);t+=1+e+sov(e)}return t}function encodeVarint(e,t,r){const n=t-=sov(r);for(;r>=maxUInt32;)e[t++]=127&r|128,r/=128;for(;r>=128;)e[t++]=127&r|128,r>>>=7;return e[t]=r,n}function sov(e){return e%2==0&&e++,Math.floor((len64(e)+6)/7)}function len64(e){let t=0;return e>=maxInt32&&(e=Math.floor(e/maxInt32),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+len8tab[e]}const len8tab=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],pbNodeProperties=["Data","Links"],pbLinkProperties=["Hash","Name","Tsize"],util_textEncoder=new TextEncoder;function linkComparator(e,t){if(e===t)return 0;const r=e.Name?util_textEncoder.encode(e.Name):[],n=t.Name?util_textEncoder.encode(t.Name):[];let o=r.length,i=n.length;for(let e=0,t=Math.min(o,i);e<t;++e)if(r[e]!==n[e]){o=r[e],i=n[e];break}return o<i?-1:i<o?1:0}function hasOnlyProperties(e,t){return!Object.keys(e).some((e=>!t.includes(e)))}function asLink(e){if("object"==typeof e.asCID){const t=cid_CID.asCID(e);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(e.Hash){let r=cid_CID.asCID(e.Hash);try{r||("string"==typeof e.Hash?r=cid_CID.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=cid_CID.decode(e.Hash)))}catch(e){throw new TypeError(`Invalid DAG-PB form: ${e.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function prepare(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(void 0!==e.Data)if("string"==typeof e.Data)t.Data=util_textEncoder.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(void 0!==e.Links){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(asLink),t.Links.sort(linkComparator)}else t.Links=[];return t}function validate(e){if(!e||"object"!=typeof e||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form");if(!hasOnlyProperties(e,pbNodeProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){const r=e.Links[t];if(!r||"object"!=typeof r||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!hasOnlyProperties(r,pbLinkProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(void 0===r.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(null==r.Hash||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==r.Name&&"string"!=typeof r.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==r.Tsize){if("number"!=typeof r.Tsize||r.Tsize%1!=0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&-1===linkComparator(r,e.Links[t-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function createNode(e,t=[]){return prepare({Data:e,Links:t})}function createLink(e,t,r){return asLink({Hash:r,Name:e,Tsize:t})}function toByteView(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}const src_name="dag-pb",code=112;function src_encode(e){validate(e);const t={};return e.Links&&(t.Links=e.Links.map((e=>{const t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),e.Data&&(t.Data=e.Data),encodeNode(t)}function src_decode(e){const t=decodeNode(toByteView(e)),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map((e=>{const t={};try{t.Hash=cid_CID.decode(e.Hash)}catch(e){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),r}var minimal=__webpack_require__(946);const $Reader=minimal.Reader,$Writer=minimal.Writer,$util=minimal.util,$root=minimal.roots.unixfs||(minimal.roots.unixfs={}),Data=$root.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util.newBuffer([]),e.prototype.filesize=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=$util.emptyArray,e.prototype.hashType=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.fanout=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=$Writer.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var r=0;r<e.blocksizes.length;++r)t.uint32(32).uint64(e.blocksizes[r]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&$root.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.Data;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;case 3:n.filesize=e.uint64();break;case 4:if(n.blocksizes&&n.blocksizes.length||(n.blocksizes=[]),2==(7&o))for(var i=e.uint32()+e.pos;e.pos<i;)n.blocksizes.push(e.uint64());else n.blocksizes.push(e.uint64());break;case 5:n.hashType=e.uint64();break;case 6:n.fanout=e.uint64();break;case 7:n.mode=e.uint32();break;case 8:n.mtime=$root.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&o)}}if(!n.hasOwnProperty("Type"))throw $util.ProtocolError("missing required 'Type'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root.Data)return e;var t=new $root.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5}if(null!=e.Data&&("string"==typeof e.Data?$util.base64.decode(e.Data,t.Data=$util.newBuffer($util.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&($util.Long?(t.filesize=$util.Long.fromValue(e.filesize)).unsigned=!0:"string"==typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"==typeof e.filesize?t.filesize=e.filesize:"object"==typeof e.filesize&&(t.filesize=new $util.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var r=0;r<e.blocksizes.length;++r)$util.Long?(t.blocksizes[r]=$util.Long.fromValue(e.blocksizes[r])).unsigned=!0:"string"==typeof e.blocksizes[r]?t.blocksizes[r]=parseInt(e.blocksizes[r],10):"number"==typeof e.blocksizes[r]?t.blocksizes[r]=e.blocksizes[r]:"object"==typeof e.blocksizes[r]&&(t.blocksizes[r]=new $util.LongBits(e.blocksizes[r].low>>>0,e.blocksizes[r].high>>>0).toNumber(!0))}if(null!=e.hashType&&($util.Long?(t.hashType=$util.Long.fromValue(e.hashType)).unsigned=!0:"string"==typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"==typeof e.hashType?t.hashType=e.hashType:"object"==typeof e.hashType&&(t.hashType=new $util.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&($util.Long?(t.fanout=$util.Long.fromValue(e.fanout)).unsigned=!0:"string"==typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"==typeof e.fanout?t.fanout=e.fanout:"object"==typeof e.fanout&&(t.fanout=new $util.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!=typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=$root.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.blocksizes=[]),t.defaults){if(r.Type=t.enums===String?"Raw":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util.newBuffer(r.Data))),$util.Long){var n=new $util.Long(0,0,!0);r.filesize=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.filesize=t.longs===String?"0":0;if($util.Long){n=new $util.Long(0,0,!0);r.hashType=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.hashType=t.longs===String?"0":0;if($util.Long){n=new $util.Long(0,0,!0);r.fanout=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.fanout=t.longs===String?"0":0;r.mode=0,r.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"==typeof e.filesize?r.filesize=t.longs===String?String(e.filesize):e.filesize:r.filesize=t.longs===String?$util.Long.prototype.toString.call(e.filesize):t.longs===Number?new $util.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){r.blocksizes=[];for(var o=0;o<e.blocksizes.length;++o)"number"==typeof e.blocksizes[o]?r.blocksizes[o]=t.longs===String?String(e.blocksizes[o]):e.blocksizes[o]:r.blocksizes[o]=t.longs===String?$util.Long.prototype.toString.call(e.blocksizes[o]):t.longs===Number?new $util.LongBits(e.blocksizes[o].low>>>0,e.blocksizes[o].high>>>0).toNumber(!0):e.blocksizes[o]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"==typeof e.hashType?r.hashType=t.longs===String?String(e.hashType):e.hashType:r.hashType=t.longs===String?$util.Long.prototype.toString.call(e.hashType):t.longs===Number?new $util.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"==typeof e.fanout?r.fanout=t.longs===String?String(e.fanout):e.fanout:r.fanout=t.longs===String?$util.Long.prototype.toString.call(e.fanout):t.longs===Number?new $util.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(r.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(r.mtime=$root.UnixTime.toObject(e.mtime,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),UnixTime=$root.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Seconds=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=$Writer.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.UnixTime;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Seconds=e.int64();break;case 2:n.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&o)}}if(!n.hasOwnProperty("Seconds"))throw $util.ProtocolError("missing required 'Seconds'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root.UnixTime)return e;var t=new $root.UnixTime;return null!=e.Seconds&&($util.Long?(t.Seconds=$util.Long.fromValue(e.Seconds)).unsigned=!1:"string"==typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"==typeof e.Seconds?t.Seconds=e.Seconds:"object"==typeof e.Seconds&&(t.Seconds=new $util.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if($util.Long){var n=new $util.Long(0,0,!1);r.Seconds=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.Seconds=t.longs===String?"0":0;r.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"==typeof e.Seconds?r.Seconds=t.longs===String?String(e.Seconds):e.Seconds:r.Seconds=t.longs===String?$util.Long.prototype.toString.call(e.Seconds):t.longs===Number?new $util.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(r.FractionalNanoseconds=e.FractionalNanoseconds),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})(),Metadata=$root.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.Metadata;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.MimeType=e.string();else e.skipType(7&o)}return n},e.fromObject=function(e){if(e instanceof $root.Metadata)return e;var t=new $root.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(r.MimeType=e.MimeType),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})(),unixfs_NodeType=Data.DataType,EMPTY=Object.freeze([]),EMPTY_BUFFER=new Uint8Array(0),BLANK=Object.freeze({}),DEFAULT_FILE_MODE=parseInt("0644",8),DEFAULT_DIRECTORY_MODE=parseInt("0755",8),codec_code=code,codec_name="UnixFS",encodePB=(e,t)=>(Object(globalThis).debug&&console.log({data:e,links:t}),src_encode(prepare({Data:Data.encode(e).finish(),Links:t}))),createRaw=e=>({type:unixfs_NodeType.Raw,content:e}),createEmptyFile=e=>createSimpleFile(EMPTY_BUFFER,e),createSimpleFile=(e,t)=>({type:unixfs_NodeType.File,layout:"simple",content:e,metadata:decodeMetadata(t)}),createFileChunk=e=>({type:unixfs_NodeType.File,layout:"simple",content:e}),createAdvancedFile=(e,t)=>({type:unixfs_NodeType.File,layout:"advanced",parts:e,metadata:decodeMetadata(t)}),createFileShard=e=>({type:unixfs_NodeType.File,layout:"advanced",parts:e}),createComplexFile=(e,t,r)=>({type:unixfs_NodeType.File,layout:"complex",content:e,parts:t,metadata:decodeMetadata(r)}),createFlatDirectory=(e,t)=>({type:unixfs_NodeType.Directory,metadata:decodeMetadata(t),entries:e}),createShardedDirectory=(e,t,r,n,o=BLANK)=>({type:unixfs_NodeType.HAMTShard,bitfield:t,fanout:readFanout(r),hashType:readInt(n),entries:e,metadata:decodeMetadata(o)}),createDirectoryShard=(e,t,r,n)=>({type:unixfs_NodeType.HAMTShard,bitfield:t,fanout:readFanout(r),hashType:readInt(n),entries:e}),encodeRaw=e=>encodePB({Type:unixfs_NodeType.Raw,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:EMPTY},[]),encodeFile=(e,t=!1)=>{const r=t?BLANK:Object(e).metadata;switch(e.layout){case"simple":return encodeSimpleFile(e.content,r);case"advanced":return encodeAdvancedFile(e.parts,r);case"complex":return encodeComplexFile(e.content,e.parts,r);default:throw new TypeError(`File with unknown layout "${Object(e).layout}" was passed`)}},encodeFileChunk=e=>encodeSimpleFile(e,BLANK),encodeFileShard=e=>encodePB({Type:unixfs_NodeType.File,blocksizes:e.map(contentByteLength),filesize:cumulativeContentByteLength(e)},e.map(codec_encodeLink)),encodeAdvancedFile=(e,t=BLANK)=>encodePB({Type:unixfs_NodeType.File,blocksizes:e.map(contentByteLength),filesize:cumulativeContentByteLength(e),...encodeMetadata(t)},e.map(codec_encodeLink)),codec_encodeLink=e=>({Name:"",Tsize:e.dagByteLength,Hash:e.cid}),encodeSimpleFile=(e,t=BLANK)=>encodePB({Type:unixfs_NodeType.File,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:[],...encodeMetadata(t)},[]),encodeComplexFile=(e,t,r=BLANK)=>encodePB({Type:unixfs_NodeType.File,Data:e,filesize:e.byteLength+cumulativeContentByteLength(t),blocksizes:t.map(contentByteLength)},t.map(codec_encodeLink)),encodeDirectory=e=>encodePB({Type:e.type,...encodeDirectoryMetadata(e.metadata||BLANK)},e.entries.map(encodeNamedLink)),encodeHAMTShard=({bitfield:e,fanout:t,hashType:r,entries:n,metadata:o=BLANK})=>encodePB({Type:unixfs_NodeType.HAMTShard,Data:e.byteLength>0?e:void 0,fanout:readFanout(t),hashType:readInt(r),...encodeDirectoryMetadata(o)},n.map(encodeNamedLink)),readFanout=e=>{if(Math.log2(e)%1==0)return e;throw new TypeError(`Expected hamt size to be a power of two instead got ${e}`)},readInt=e=>{if(Number.isInteger(e))return e;throw new TypeError(`Expected an integer value instead got ${e}`)},readData=e=>e.byteLength>0?e:void 0,createSymlink=(e,t=BLANK)=>({type:unixfs_NodeType.Symlink,content:e,metadata:decodeMetadata(t)}),encodeSymlink=(e,t=!1)=>{const r=t?BLANK:Object(e).metadata;return encodePB({Type:unixfs_NodeType.Symlink,Data:e.content,...encodeMetadata(r||BLANK)},[])},codec_encode=(e,t=!0)=>{switch(e.type){case unixfs_NodeType.Raw:return encodeRaw(e.content);case unixfs_NodeType.File:return encodeFile(e);case unixfs_NodeType.Directory:return encodeDirectory(e);case unixfs_NodeType.HAMTShard:return encodeHAMTShard(e);case unixfs_NodeType.Symlink:return encodeSymlink(e);default:throw new Error(`Unknown node type ${Object(e).type}`)}},codec_decode=e=>{const t=src_decode(e),r=Data.decode(t.Data),{Type:n,Data:o,mtime:i,mode:a,blocksizes:s,...c}=Data.toObject(r,{defaults:!1,arrays:!0,longs:Number,objects:!1}),u={...a&&{mode:a},...decodeMtime(i)},l=t.Links;switch(r.Type){case unixfs_NodeType.Raw:return createRaw(o);case unixfs_NodeType.File:return 0===l.length?new SimpleFileView(o,u):0===o.byteLength?new AdvancedFileView(decodeFileLinks(c.blocksizes,l),u):new ComplexFileView(o,decodeFileLinks(c.blocksizes,l),u);case unixfs_NodeType.Directory:return createFlatDirectory(decodeDirectoryLinks(l),u);case unixfs_NodeType.HAMTShard:return createShardedDirectory(decodeDirectoryLinks(l),o||EMPTY_BUFFER,c.fanout,c.hashType,u);case unixfs_NodeType.Symlink:return createSymlink(o,u);default:throw new TypeError(`Unsupported node type ${r.Type}`)}},decodeMtime=e=>null==e?void 0:{mtime:{secs:e.Seconds,nsecs:e.FractionalNanoseconds||0}},decodeBlocksizes=(e,t)=>{if(e===NodeType.File)return t&&t.length>0?{blocksizes:t}:void 0},decodeFileLinks=(e,t)=>{const r=[],n=e.length;for(;0<n;)r.push({cid:t[0].Hash,dagByteLength:t[0].Tsize||0,contentByteLength:e[0]});return r},decodeDirectoryLinks=e=>e.map((e=>({cid:e.Hash,name:e.Name||"",dagByteLength:e.Tsize||0}))),cumulativeContentByteLength=e=>e.reduce(((e,t)=>e+t.contentByteLength),0),cumulativeDagByteLength=(e,t)=>t.reduce(((e,t)=>e+t.dagByteLength),e.byteLength),contentByteLength=e=>e.contentByteLength,encodeNamedLink=({name:e,dagByteLength:t,cid:r})=>({Name:e,Tsize:t,Hash:r}),encodeDirectoryMetadata=e=>encodeMetadata(e,DEFAULT_DIRECTORY_MODE),encodeMetadata=({mode:e,mtime:t},r=DEFAULT_FILE_MODE)=>({mode:null!=e?encodeMode(e,r):void 0,mtime:null!=t?encodeMTime(t):void 0}),decodeMetadata=e=>null==e?BLANK:{...null==e.mode?void 0:{mode:decodeMode(e.mode)},...null==e.mtime?void 0:{mtime:e.mtime}},encodeMTime=e=>null==e?void 0:0!==e.nsecs?{Seconds:e.secs,FractionalNanoseconds:e.nsecs}:{Seconds:e.secs},encodeMode=(e,t)=>{const r=null==e?void 0:decodeMode(e);return r===t||null==r?void 0:r},decodeMode=e=>4095&e|4294963200&e,matchFile=({content:e=EMPTY_BUFFER,parts:t=EMPTY,metadata:r=BLANK,...n})=>0===t.length?new SimpleFileView(e,r):0===e.byteLength?new AdvancedFileView(t,r):new ComplexFileView(e,t,r);class SimpleFileView{constructor(e,t){this.content=e,this.metadata=t,this.layout="simple",this.type=unixfs_NodeType.File}get filesize(){return this.content.byteLength}encode(){return encodeSimpleFile(this.content,this.metadata)}}class AdvancedFileView{constructor(e,t){this.parts=e,this.metadata=t}get layout(){return"advanced"}get type(){return unixfs_NodeType.File}get fileSize(){return cumulativeContentByteLength(this.parts)}get blockSizes(){return this.parts.map(contentByteLength)}encode(){return encodeAdvancedFile(this.parts,this.metadata)}}class ComplexFileView{constructor(e,t,r){this.content=e,this.parts=t,this.metadata=r}get layout(){return"complex"}get type(){return unixfs_NodeType.File}get fileSize(){return this.content.byteLength+cumulativeContentByteLength(this.parts)}get blockSizes(){return this.parts.map(contentByteLength)}encode(){return encodeComplexFile(this.content,this.parts,this.metadata)}}const filesize=e=>{switch(e.type){case unixfs_NodeType.Raw:case unixfs_NodeType.Symlink:return e.content.byteLength;case unixfs_NodeType.File:switch(e.layout){case"simple":return e.content.byteLength;case"advanced":return cumulativeContentByteLength(e.parts);case"complex":return e.content.byteLength+cumulativeContentByteLength(e.parts)}default:return 0}},effect=function*(e){const t=yield*e;yield*send(t)};function*current(){return yield CURRENT}const suspend=function*(){yield SUSPEND};function*sleep(e=0){const t=yield*current(),r=setTimeout(enqueue,e,t);try{yield*suspend()}finally{clearTimeout(r)}}const wait=function*(e){const t=yield*current();if(isAsync(e)){let r,n=!1;if(e.then((e=>{n=!1,r=e,enqueue(t)}),(e=>{n=!0,r=e,enqueue(t)})),yield*suspend(),n)throw r;return r}return main(wake(t)),yield*suspend(),e};function*wake(e){enqueue(e)}const isAsync=e=>null!=e&&"function"==typeof e.then,send=function*(e){yield e},listen=function*(e){const t=[];for(const r of Object.entries(e)){const[e,n]=r;n!==NONE&&t.push(yield*lib_fork(tag(n,e)))}yield*group(t)},effects=e=>e.length>0?batch(e.map(effect)):NONE;function*batch(e){const t=[];for(const r of e)t.push(yield*lib_fork(r));yield*group(t)}const tag=(e,t)=>e===NONE?NONE:e instanceof Tagger?new Tagger([...e.tags,t],e.source):new Tagger([t],e);class Tagger{constructor(e,t){this.tags=e,this.source=t,this.controller}[Symbol.iterator](){return this.controller||(this.controller=this.source[Symbol.iterator]()),this}box(e){if(e.done)return e;switch(e.value){case SUSPEND:case CURRENT:return e;default:{const t=e;let{value:r}=t;for(const e of this.tags)r=withTag(e,r);return t.value=r,t}}}next(e){return this.box(this.controller.next(e))}throw(e){return this.box(this.controller.throw(e))}return(e){return this.box(this.controller.return(e))}get[Symbol.toStringTag](){return"TaggedEffect"}}const none=()=>NONE,lib_all=function*(e){const t=yield*current(),r=e=>r=>{delete o[e],a[e]=r,i-=1,0===i&&enqueue(t)},n=e=>{for(const t of o)t&&enqueue(abort(t,e));enqueue(abort(t,e))};let o=[],i=0;for(const t of e)o.push(yield*lib_fork(then(t,r(i++),n)));const a=new Array(i);return i>0&&(yield*suspend()),a},withTag=(e,t)=>({type:e,[e]:t});function*then(e,t,r){try{return t(yield*e)}catch(e){return r(e)}}const CURRENT=Symbol("current"),SUSPEND=Symbol("suspend"),isMessage=e=>{switch(e){case SUSPEND:case CURRENT:return!1;default:return!0}},isInstruction=e=>!isMessage(e);class Group{static of(e){return e.group||MAIN}static enqueue(e,t){e.group=t,t.stack.active.push(e)}constructor(e,t=[],r=new Set,n=new Stack(t,r)){this.driver=e,this.parent=Group.of(e),this.stack=n,this.id=++ID}}class Main{constructor(){this.status=IDLE,this.stack=new Stack,this.id=0}}class Stack{constructor(e=[],t=new Set){this.active=e,this.idle=t}static size({active:e,idle:t}){return e.length+t.size}}const main=e=>enqueue(e[Symbol.iterator]()),enqueue=e=>{let t=Group.of(e);for(t.stack.active.push(e),t.stack.idle.delete(e);t.parent;){const{idle:e,active:r}=t.parent.stack;if(!e.has(t.driver))break;e.delete(t.driver),r.push(t.driver),t=t.parent}if(MAIN.status===IDLE)for(MAIN.status=ACTIVE;;)try{for(const e of step(MAIN));MAIN.status=IDLE;break}catch(e){MAIN.stack.active.shift()}},resume=e=>enqueue(e),step=function*(e){const{active:t}=e.stack;let r=t[0];for(e.stack.idle.delete(r);r;){let n=INIT;e:for(;!n.done&&r===t[0];){const t=n.value;switch(t){case SUSPEND:e.stack.idle.add(r);break e;case CURRENT:n=r.next(r);break;default:n=r.next(yield t)}}t.shift(),r=t[0],e.stack.idle.delete(r)}};function*spawn(e){main(e)}const lib_fork=(e,t)=>new Fork(e,t),exit=(e,t)=>conclude(e,{ok:!0,value:t}),terminate=e=>conclude(e,{ok:!0,value:void 0}),abort=(e,t)=>conclude(e,{ok:!1,error:t});function*conclude(e,t){try{const r=e,n=t.ok?r.return(t.value):r.throw(t.error);if(!n.done)if(n.value===SUSPEND){const{idle:e}=Group.of(r).stack;e.add(r)}else enqueue(r)}catch(e){}}function*group(e){if(0===e.length)return;const t=yield*current(),r=new Group(t);let n=null;for(const t of e){const{result:e}=t;e?e.ok||n||(n=e):move(t,r)}try{if(n)throw n.error;for(;yield*step(r),Stack.size(r.stack)>0;)yield*suspend()}catch(e){for(const t of r.stack.active)yield*abort(t,e);for(const t of r.stack.idle)yield*abort(t,e),enqueue(t);throw e}}const move=(e,t)=>{const r=Group.of(e);if(r!==t){const{active:n,idle:o}=r.stack,i=t.stack;if(e.group=t,o.has(e))o.delete(e),i.idle.add(e);else{const t=n.indexOf(e);t>=0&&(n.splice(t,1),i.active.push(e))}}};function*join(e){e.status===IDLE&&(yield*e),e.result||(yield*group([e]));const t=e.result;if(t.ok)return t.value;throw t.error}class Future{constructor(e){this.handler=e,this.result}get promise(){const{result:e}=this,t=null==e?new Promise(((e,t)=>{this.handler.onsuccess=e,this.handler.onfailure=t})):e.ok?Promise.resolve(e.value):Promise.reject(e.error);return Object.defineProperty(this,"promise",{value:t}),t}then(e,t){return this.activate().promise.then(e,t)}catch(e){return this.activate().promise.catch(e)}finally(e){return this.activate().promise.finally(e)}activate(){return this}}class Fork extends Future{constructor(e,t=lib_BLANK,r={},n=INIT){super(r),this.id=++ID,this.name=t.name||"",this.task=e,this.state=n,this.status=IDLE,this.result,this.handler=r,this.controller}*resume(){resume(this)}join(){return join(this)}abort(e){return abort(this,e)}exit(e){return exit(this,e)}get[Symbol.toStringTag](){return"Fork"}*[Symbol.iterator](){return this.activate()}activate(){return this.controller=this.task[Symbol.iterator](),this.status=ACTIVE,enqueue(this),this}panic(e){this.result={ok:!1,error:e},this.status=FINISHED;const{handler:t}=this;throw t.onfailure&&t.onfailure(e),e}step(e){if(this.state=e,e.done){this.result={ok:!0,value:e.value},this.status=FINISHED;const{handler:t}=this;t.onsuccess&&t.onsuccess(e.value)}return e}next(e){try{return this.step(this.controller.next(e))}catch(e){return this.panic(e)}}return(e){try{return this.step(this.controller.return(e))}catch(e){return this.panic(e)}}throw(e){try{return this.step(this.controller.throw(e))}catch(e){return this.panic(e)}}}const loop=function*(e,t){const r=yield*current(),n=new Group(r);for(Group.enqueue(e[Symbol.iterator](),n);;){for(const e of step(n))Group.enqueue(t(e)[Symbol.iterator](),n);if(!(Stack.size(n.stack)>0))break;yield*suspend()}};let ID=0;const IDLE="idle",ACTIVE="active",FINISHED="finished",INIT={done:!1,value:CURRENT},lib_BLANK={},NONE=function*(){}(),MAIN=new Main;function Indexed(){}Object.defineProperties(Indexed,{prototype:{value:new Proxy(Object.prototype,{get:(e,t,r)=>"symbol"==typeof t?Reflect.get(e,t,r):r.get(t)})}});const buffer_empty=()=>new BufferView,buffer_create=(e,t=0,r=totalByteLength(e))=>new BufferView(e,t,r),totalByteLength=e=>{let t=0;for(const r of e)t+=r.byteLength;return t},slice=(e,t=0,r=e.byteLength)=>{const n=[],o=t<0?e.byteLength-t:t,i=r<0?e.byteLength-r:r;if(0===o&&i>=e.byteLength)return e;if(o>i||o>e.byteLength||i<=0)return buffer_empty();let a=0,s=0;for(const t of e.segments){const e=s+t.byteLength;if(0===a){if(i<=e){const e=t.subarray(o-s,i-s);n.push(e),a=e.byteLength;break}if(o<e){const e=o===s?t:t.subarray(o-s);n.push(e),a=e.byteLength}}else{if(i<=e){const r=i===e?t:t.subarray(0,i-s);n.push(r),a+=r.byteLength;break}n.push(t),a+=t.byteLength}s=e}return new BufferView(n,e.byteOffset+o,a)},push=(e,t)=>t.byteLength>0?(e.segments.push(t),new BufferView(e.segments,e.byteOffset,e.byteLength+t.byteLength)):e,get=(e,t)=>{if(t<e.byteLength){let r=0;for(const n of e.segments){if(t<r+n.byteLength)return n[t-r];r+=n.byteLength}}},copyTo=(e,t,r)=>{let n=r;for(const r of e.segments)t.set(r,n),n+=r.byteLength;return t};function*iterate(e){for(const t of e.segments)yield*t}class BufferView extends Indexed{constructor(e=[],t=0,r=0){super(),this.segments=e,this.byteLength=r,this.length=r,this.byteOffset=t}[Symbol.iterator](){return iterate(this)}slice(e,t){return slice(this,e,t)}subarray(e,t){return slice(this,e,t)}push(e){return push(this,e)}get(e){return get(this,e)}copyTo(e,t){return copyTo(this,e,t)}}const panic=e=>{throw new Error(e)},unreachable=(e,t,...r)=>panic(String.raw(e,JSON.stringify(t),...r)),util_EMPTY_BUFFER=new Uint8Array(0),util_EMPTY=[],chunker_open=e=>({config:e,buffer:buffer_empty()}),write=(e,t)=>t.byteLength>0?split(e.config,e.buffer.push(t),!1):{...e,chunks:util_EMPTY},chunker_close=e=>split(e.config,e.buffer,!0),split=(e,t,r)=>{const n=e.chunker,o=[];let i=0;for(const e of n.cut(n.context,t,r))if(e>0){const r=t.subarray(i,i+e);o.push(r),i+=e}return{config:e,chunks:o,buffer:t.subarray(i)}},queue_empty=()=>({mutable:!1,needs:{},nodes:{},links:{},linked:[]}),mutable=()=>({mutable:!0,needs:{},nodes:{},links:{},linked:queue_EMPTY}),addNode=(e,t)=>addNodes([e],t),addNodes=(e,t)=>{let r=patch(t,{});for(const t of e){const{ready:e,has:n,wants:o}=collect(t.children,r.links);r=0===o.length?patch(r,{links:queue_assign(void 0,n),linked:[{id:t.id,links:e}]}):patch(r,{needs:queue_assign(t.id,o),nodes:{[t.id]:{children:t.children,count:o.length}}})}return r},addLink=(e,t,r)=>{const n=r.needs[e],o=r.nodes[n];if(null!=o){if(1===o.count){const{ready:i,has:a}=collect(o.children,{...r.links,[e]:t});return patch(r,{needs:{[e]:void 0},links:queue_assign(void 0,a),nodes:{[n]:void 0},linked:[{id:n,links:i}]})}return patch(r,{needs:{[e]:void 0},links:{[e]:t},nodes:{[n]:{...o,count:o.count-1}}})}return patch(r,{links:{[e]:t}})},patch=(e,{needs:t,nodes:r,links:n,linked:o})=>{const i=e.mutable?e:{...e},a=e.mutable?queue_BLANK:void 0;return t&&(i.needs=patchDict(e.needs,t,a)),r&&(i.nodes=patchDict(e.nodes,r,a)),n&&(i.links=patchDict(e.links,n,a)),i.linked=o?append(e.linked||queue_EMPTY,o,queue_EMPTY):e.linked||[],i},queue_assign=(e,t)=>{const r={};for(const n of t)r[n]=e;return r},patchDict=(e,t,r=e)=>{const n=e===r?{...e}:e;for(const e of Object.entries(t)){const[t,r]=e;null==r?delete n[t]:n[t]=r}return n},addLinks=(e,t)=>{for(const[r,n]of e)t=addLink(r,n,t);return t},isEmpty=e=>0===Object.keys(e.nodes).length&&0===Object.keys(e.links).length,append=(e,t,r=e)=>{if(e===r)return[...e,...t];for(const r of t)e.push(r);return e},collect=(e,t)=>{const r=[],n=[],o=[];for(const i of e){const e=t[i];e?(r.push(i),o.push(e)):n.push(i)}return{has:r,wants:n,ready:o}},queue_EMPTY=Object.freeze([]),queue_BLANK=Object.freeze({}),update=(e,t)=>{switch(e.type){case"write":return writer_write(t,e.bytes);case"link":return writer_link(t,e.link);case"block":case"end":return{state:t,effect:none()};case"close":return writer_close(t);default:return unreachable`File Writer got unknown message ${e}`}},init=(e,t,r)=>({status:"open",metadata:t,config:r,writer:e,chunker:chunker_open({chunker:r.chunker}),layout:r.fileLayout.open(),nodeQueue:mutable()}),writer_write=(e,t)=>{if("open"===e.status){const{chunks:r,...n}=write(e.chunker,t),{nodes:o,leaves:i,layout:a}=e.config.fileLayout.write(e.layout,r),{linked:s,...c}=addNodes(o,e.nodeQueue),u=[...encodeLeaves(i,e.config),...encodeBranches(s,e.config)];return{state:{...e,chunker:n,layout:a,nodeQueue:c},effect:listen({link:effects(u)})}}return panic("Unable to perform write on closed file")},writer_link=(e,{id:t,link:r,block:n})=>{let{linked:o,...i}=addLink(t,r,e.nodeQueue);const a=encodeBranches(o,e.config),s="closed"===e.status&&t===e.rootID?{...e,status:"linked",link:r,nodeQueue:i}:{...e,nodeQueue:i},c="closed"===e.status&&t===e.rootID&&e.end?e.end.resume():none();return{state:s,effect:listen({link:effects(a),block:writeBlock(e.writer,n),end:c})}},writer_close=e=>{if("open"===e.status){const{chunks:t}=chunker_close(e.chunker),{layout:r,...n}=e.config.fileLayout.write(e.layout,t),{root:o,...i}=e.config.fileLayout.close(r,e.metadata),[a,s]=isLeafNode(o)?[[...n.nodes,...i.nodes],[...n.leaves,...i.leaves,o]]:[[...n.nodes,...i.nodes,o],[...n.leaves,...i.leaves]],{linked:c,...u}=addNodes(a,e.nodeQueue),l=[...encodeLeaves(s,e.config),...encodeBranches(c,e.config)],d=lib_fork(suspend());return{state:{...e,chunker:null,layout:null,rootID:o.id,status:"closed",end:d,nodeQueue:u},effect:listen({link:effects(l),end:join(d)})}}return{state:e,effect:none()}},encodeLeaves=(e,t)=>e.map((e=>encodeLeaf(t,e,t.fileChunkEncoder))),encodeLeaf=function*({hasher:e,linker:t},{id:r,content:n},o){const i=o.encode(n?asUint8Array(n):util_EMPTY_BUFFER),a=yield*wait(e.digest(i)),s=t.createLink(o.code,a);return{id:r,block:{cid:s,bytes:i},link:{cid:s,contentByteLength:n?n.byteLength:0,dagByteLength:i.byteLength}}},encodeBranches=(e,t)=>e.map((e=>encodeBranch(t,e))),encodeBranch=function*(e,{id:t,links:r},n){const o=e.fileEncoder.encode({type:unixfs_NodeType.File,layout:"advanced",parts:r,metadata:n}),i=yield*wait(Promise.resolve(e.hasher.digest(o))),a=e.linker.createLink(e.fileEncoder.code,i);return{id:t,block:{bytes:o,cid:a},link:{cid:a,contentByteLength:cumulativeContentByteLength(r),dagByteLength:cumulativeDagByteLength(o,r)}}},writeBlock=function*(e,t){(e.desiredSize||0)<=0&&(yield*wait(e.ready)),e.write(t)},asUint8Array=e=>e instanceof Uint8Array?e:e.copyTo(new Uint8Array(e.byteLength),0),isLeafNode=e=>null==e.children,fixed_name="fixed",context={maxChunkSize:262144},type="Stateless",withMaxChunkSize=e=>({type:"Stateless",context:{maxChunkSize:e},name:fixed_name,cut}),cut=({maxChunkSize:e},{byteLength:t},r)=>{const n=t/e|0,o=new Array(n).fill(e),i=r?t-n*e:0;return i>0&&o.push(i),o};function hasher_from({name:e,code:t,encode:r}){return new Hasher(e,t,r)}class Hasher{name;code;encode;constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?create(this.code,t):t.then((e=>create(this.code,e)))}throw Error("Unknown type, must be binary type")}}function sha(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}const sha256=hasher_from({name:"sha2-256",code:18,encode:sha("SHA-256")}),sha512=hasher_from({name:"sha2-512",code:19,encode:sha("SHA-512")});class Node{constructor(e,t,r){this.id=e,this.children=t,this.metadata=r}}const withWidth=e=>({open:()=>balanced_open({width:e}),write:balanced_write,close:balanced_close}),defaults={width:174},balanced_open=({width:e}=defaults)=>({width:e,head:null,leafIndex:[],nodeIndex:[],lastID:0}),balanced_write=(e,t)=>{if(0===t.length)return{layout:e,nodes:balanced_EMPTY,leaves:balanced_EMPTY};{let{lastID:r}=e;const[n,o]=e.head?[null,(t.unshift(e.head),t)]:1===t.length&&0===e.leafIndex.length?[t[0],balanced_EMPTY]:[null,t];if(0===o.length)return{layout:{...e,head:n},nodes:balanced_EMPTY,leaves:balanced_EMPTY};{const t=[...e.leafIndex],i=[];for(const e of o){const n={id:++r,content:e};i.push(n),t.push(n.id)}return t.length>e.width?flush({...e,leafIndex:t,head:n,lastID:r},i):{layout:{...e,head:n,leafIndex:t,lastID:r},leaves:i,nodes:balanced_EMPTY}}}},flush=(e,t=balanced_EMPTY,r=[],n=!1)=>{let{lastID:o}=e;const i=e.nodeIndex.map((e=>[...e])),a=[...e.leafIndex],{width:s}=e;for(;a.length>s||a.length>0&&n;){grow(i,1);const e=new Node(++o,a.splice(0,s));i[0].push(e.id),r.push(e)}let c=0;for(;c<i.length;){const e=i[c];for(c++;e.length>s||e.length>0&&n&&c<i.length;){const t=new Node(++o,e.splice(0,s));grow(i,c+1),i[c].push(t.id),r.push(t)}}return{layout:{...e,lastID:o,leafIndex:a,nodeIndex:i},leaves:t,nodes:r}},balanced_close=(e,t)=>{const r=e;if(e.head)return{root:{id:1,content:e.head,metadata:t},leaves:balanced_EMPTY,nodes:balanced_EMPTY};if(0===e.leafIndex.length)return{root:{id:1,metadata:t},leaves:balanced_EMPTY,nodes:balanced_EMPTY};{const{nodes:e,layout:n}=flush(r,balanced_EMPTY,[],!0),{nodeIndex:o}=n,i=o[o.length-1];if(1===i.length){const t=e[e.length-1];return e.length=e.length-1,{root:t,nodes:e,leaves:balanced_EMPTY}}return{root:new Node(n.lastID+1,i,t),nodes:e,leaves:balanced_EMPTY}}},grow=(e,t)=>{for(;e.length<t;)e.push([]);return e},balanced_EMPTY=[],file_defaults=()=>({chunker:fixed_namespaceObject,fileChunkEncoder:UnixFSLeaf,smallFileEncoder:UnixFSLeaf,fileEncoder:codec_namespaceObject,fileLayout:withWidth(174),hasher:sha256,linker:{createLink:cid_CID.createV1}}),configure=e=>({...file_defaults(),...e}),UnixFSLeaf={code:codec_code,name:codec_name,encode:encodeFileChunk},UnixFSRawLeaf={code:codec_code,name:codec_name,encode:encodeRaw},file_create=({writer:e,metadata:t={},settings:r=file_defaults()})=>new FileWriterView(init(e,t,configure(r))),file_write=async(e,t)=>(await perform(e,send({type:"write",bytes:t})),e),file_close=async(e,{releaseLock:t=!1,closeWriter:r=!1}={})=>{await perform(e,send({type:"close"}));const{state:n}=e;if("linked"===n.status)return r?await e.state.writer.close():t&&e.state.writer.releaseLock(),n.link;panic(`Expected writer to be in 'linked' state after close, but it is in "${n.status}" instead`)},perform=(e,t)=>lib_fork(loop(t,(t=>{const{state:r,effect:n}=update(t,e.state);return e.state=r,n})));class FileWriterView{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.config}write(e){return file_write(this,e)}close(e){return file_close(this,e)}}const directory_configure=configure,directory_defaults=file_defaults,directory_create=({writer:e,settings:t=directory_defaults(),metadata:r={}})=>new DirectoryWriter({writer:e,metadata:r,settings:t,entries:new Map,closed:!1}),set=(e,t,r,{overwrite:n=!1}={})=>{const o=asWritable(e.state);if(t.includes("/"))throw new Error(`Directory entry name "${t}" contains forbidden "/" character`);if(!n&&o.entries.has(t))throw new Error(`Directory already contains entry with name "${t}"`);return o.entries.set(t,r),e},remove=(e,t)=>(asWritable(e.state).entries.delete(t),e),asWritable=e=>{if(e.closed)throw new Error("Can not change written directory, but you can .fork() and make changes to it");return e},directory_close=async(e,{closeWriter:t=!1,releaseLock:r=!1}={})=>{const{writer:n,settings:o,metadata:i}=asWritable(e.state);e.state.closed=!0;const a=[...links(e)],s=createFlatDirectory(a,i),c=encodeDirectory(s),u=await o.hasher.digest(c),l=o.linker.createLink(codec_code,u);return(n.desiredSize||0)<=0&&await n.ready,n.write({cid:l,bytes:c}),t?await n.close():r&&n.releaseLock(),{cid:l,dagByteLength:cumulativeDagByteLength(c,a)}},links=function*({state:e}){for(const[t,{dagByteLength:r,cid:n}]of e.entries)yield{name:t,dagByteLength:r,cid:n}},fork=({state:e},{writer:t=e.writer,metadata:r=e.metadata,settings:n=e.settings}={})=>new DirectoryWriter({writer:t,metadata:r,settings:n,entries:new Map(e.entries.entries()),closed:!1});class DirectoryWriter{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.settings}links(){return links(this)}set(e,t,r){return set(this,e,t,r)}remove(e){return remove(this,e)}fork(e){return fork(this,e)}close(e){return directory_close(this,e)}entries(){return this.state.entries.entries()}has(e){return this.state.entries.has(e)}get size(){return this.state.entries.size}}const Uint32_empty=(e=32)=>{if(32!==e)throw new Error(`Uint32 BitField does not support size: ${e}`);return 0},Uint32_from=(e,t)=>{let r=Uint32_empty(t);for(const t of e)r=Uint32_set(r,t);return r},size=e=>32,mask=(e,t)=>e>>>t&31,offset=(e,t)=>1<<mask(e,t),popcount=(e,t=31)=>bitCount(e&offset(t,0)-1),Uint32_set=(e,t)=>e|1<<t,unset=(e,t)=>e&(255^1<<t),Uint32_get=(e,t)=>!!(e>>t&1),bitCount=e=>{const t=e-(e>>1&1431655765),r=(858993459&t)+(t>>2&858993459);return 16843009*(r+(r>>4)&252645135)>>24},and=(e,t)=>e&t,Uint32_or=(e,t)=>e|t,toBytes=e=>Uint8Array.of(e>>24&255,e>>16&255,e>>8&255,255&e),fromBytes=e=>{if(4!==e.length)throw new Error(`Expected 4 bytes instead got ${e.length}`);return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]};var murmurhash3js_revisited=__webpack_require__(437);const utf8=new TextEncoder,hash32=murmurhash3js_revisited.x64.hash126,Uint32_configure=({bitWidth:e=5,hash:t=hash32})=>{if(e>32)throw new RangeError(`Can not use bitWidth ${e} which exceeds the hashSize 4`);const r=4294967295>>>32-e;return{at:(t,n)=>t>>>n*e&r,from:e=>t(utf8.encode(e)),size:Math.ceil(32/e)}};class BitmapIndexedNode{constructor(e,t,r,n,o){this.edit=e,this.config=o,this.datamap=t,this.nodemap=r,this.children=n}get nodeArity(){return this.config.BitField.popcount(this.nodemap)}get dataArity(){return this.config.BitField.popcount(this.datamap)}empty(){return node_create(this.config)}lookup(e,t,r,n){return lookup(this,e,t,r,n)}associate(e,t,r,n,o,i){return associate(this,e,t,r,n,o,i)}dissociate(e,t,r,n,o){return dissociate(this,e,t,r,n,o)}fork(e=null){return node_fork(this,e)}entries(){return entries(this)}keys(){return keys(this)}values(){return values(this)}}class HashCollisionNode{constructor(e,t,r,n){this.edit=e,this.count=t,this.children=r,this.config=n}get nodeArity(){return 0}get dataArity(){return this.count}lookup(e,t,r,n){return lookupCollision(this,r,n)}associate(e,t,r,n,o,i){return associateCollision(this,e,r,n,o,i)}dissociate(e,t,r,n,o){return dissociateCollision(this,e,r,n,o)}fork(e=null){return forkCollision(this,e)}entries(){return entries(this)}keys(){return keys(this)}values(){return values(this)}}const lookupCollision=(e,t,r)=>{const{children:n,count:o}=e,i=findHashCollisionNodeIndex(n,o,t);return n[i]===t?n[i+1]:r},associateCollision=(e,t,r,n,o,i)=>{const{children:a,count:s}=e,c=findHashCollisionNodeIndex(a,s,n);if(a[c]!==n){const n=e.fork(t);return i.value=!0,n.count+=1,n.children.splice(c,r,o),n}if(a[c+1]!==o){const r=e.fork(t);return r.children[c+1]=o,r}return e},dissociateCollision=(e,t,r,n,o)=>{const{children:i,count:a,config:s}=e,c=findHashCollisionNodeIndex(i,a,n);if(i[c]!==n)return e;if(o.value=!0,2===a){const e=0===c?2:0;return associate(node_create(s),t,0,r,i[e],i[e+1],o)}{const r=e.fork(t);return r.children.splice(c,2),r.count-=1,r}},forkCollision=(e,t=null)=>canEdit(e.edit,t)?e:new HashCollisionNode(t,e.count,e.children.slice(),e.config),findHashCollisionNodeIndex=(e,t,r)=>{let n=0;for(;n<t&&e[n]>r;)n+=2;return n},defaultConfig={bitWidth:32,BitField:Uint32_namespaceObject,Path:path_Uint32_namespaceObject},node_create=(e,t=null)=>new BitmapIndexedNode(t,e.BitField.empty(Math.pow(2,e.bitWidth)),e.BitField.empty(Math.pow(2,e.bitWidth)),[],e),node_get=(e,t,r)=>lookup(e,0,e.config.Path.from(t),t,r),lookup=(e,t,r,n,o)=>{const{datamap:i,nodemap:a,config:s}=e,{Path:c,BitField:u}=s,l=c.at(r,t);if(u.get(i,l)){const t=u.popcount(i,l);return keyAt(e,t)===n?valueAt(e,t):o}if(u.get(a,l)){return resolveNode(e,l).lookup(t+1,r,n,o)}return o},node_set=(e,t,r,n,o)=>associate(e,t,0,e.config.Path.from(r),r,n,o),associate=(e,t,r,n,o,i,a)=>{const{datamap:s,nodemap:c,config:u}=e,{Path:l,BitField:d}=u,f=l.at(n,r);if(d.get(s,f)){const c=d.popcount(s,f),h=keyAt(e,c);if(o===h)return valueAt(e,c)===i?e:forkAndSet(e,t,c,i);{const s=mergeTwoLeaves(u,t,r+1,l.from(h),h,valueAt(e,c),n,o,i);return a.value=!0,migrateLeafToBranch(e,t,f,s)}}if(d.get(c,f)){const s=resolveNode(e,f),c=s.associate(t,r+1,n,o,i,a);return s===c?e:copyAndSetChild(e,t,f,c)}{const r=d.popcount(s,f);a.value=!0;const n=e.fork(t);return n.datamap=d.set(s,f),n.children.splice(keyPosition(r),0,o,i),n}},node_remove=(e,t,r,n)=>dissociate(e,t,0,e.config.Path.from(r),r,n),dissociate=(e,t,r,n,o,i)=>{const{datamap:a,nodemap:s,config:c}=e,{BitField:u,Path:l}=c,d=l.at(n,r);if(u.get(a,d)){const r=u.popcount(a,d);if(o===keyAt(e,r)){i.value=!0;const n=node_fork(e,t);return n.datamap=u.unset(e.datamap,d),n.children.splice(keyPosition(r),2),n}return e}if(u.get(s,d)){const a=resolveNode(e,d),s=a.dissociate(t,r+1,n,o,i);return hasSingleLeaf(s)?hasSingleNode(e)?s:inlineChild(e,t,d,s):a===s?e:copyAndSetChild(e,t,d,s)}return e},entries=function*({children:e}){let t=0;const r=e.length;for(;t<r;){const r=e[t];if("string"!=typeof r)break;{t+=1;const n=e[t];yield[r,n],t+=1}}for(;t<r;){const r=e[t];yield*r.entries(),t+=1}},node_fork=(e,t)=>{if(canEdit(e.edit,t))return e;return new BitmapIndexedNode(t,e.datamap,e.nodemap,e.children.slice(),e.config)},keys=function*({children:e}){let t=0;const r=e.length;for(;t<r;){const r=e[t];if("string"!=typeof r)break;yield r,t+=2}for(;t<r;){const r=e[t];yield*r.keys(),t+=1}},values=function*({children:e}){let t=0;const r=e.length;for(;t<r;){if("string"!=typeof e[t])break;t+=1,yield e[t],t+=1}for(;t<r;){const r=e[t];yield*r.values(),t+=1}},forkAndSet=(e,t,r,n)=>{const o=e.fork(t);return o.children[valuePosition(r)]=n,o},inlineChild=(e,t,r,n)=>{const{datamap:o,nodemap:i,config:a}=e,{BitField:s}=a,c=node_fork(e,t);return c.children.splice(nodePosition(e,r),1),c.children.splice(keyPosition(s.popcount(o,r)),0,n.children[0],n.children[1]),c.datamap=s.set(o,r),c.nodemap=s.unset(i,r),c},copyAndSetChild=(e,t,r,n)=>{const o=node_fork(e,t);return o.children[nodePosition(e,r)]=n,o},migrateLeafToBranch=(e,t,r,n)=>{const{nodemap:o,datamap:i,config:a}=e,{BitField:s}=a,c=s.popcount(i,r),u=keyPosition(c),l=nodePosition(e,r),d=node_fork(e,t);return d.datamap=s.unset(i,r),d.children.splice(u,2),d.nodemap=s.set(o,r),d.children.splice(l-1,0,n),d},mergeTwoLeaves=(e,t,r,n,o,i,a,s,c)=>{const{BitField:u,Path:l}=e;if(l.size<r)return new HashCollisionNode(t,2,[o,i,s,c],e);{const d=l.at(n,r),f=l.at(a,r);return d===f?new BitmapIndexedNode(t,u.empty(Math.pow(2,e.bitWidth)),u.from([d],Math.pow(2,e.bitWidth)),[mergeTwoLeaves(e,t,r+1,n,o,i,a,s,c)],e):new BitmapIndexedNode(t,u.from([d,f],Math.pow(2,e.bitWidth)),u.empty(Math.pow(2,e.bitWidth)),d<f?[o,i,s,c]:[s,c,o,i],e)}},keyAt=({children:e},t)=>e[keyPosition(t)],keyPosition=e=>2*e,valueAt=({children:e},t)=>e[valuePosition(t)],valuePosition=e=>2*e+1,resolveNode=(e,t)=>e.children[nodePosition(e,t)],nodePosition=({children:e,nodemap:t,config:r},n)=>e.length-1-r.BitField.popcount(t,n),canEdit=(e,t)=>null!=e&&e===t,hasSingleLeaf=e=>0===e.nodeArity&&1===e.dataArity,hasSingleNode=({config:{BitField:e},datamap:t,nodemap:r})=>0===e.popcount(t)&&1===e.popcount(r);function fromNumberTo32BitBuf(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}const murmur332=hasher_from({name:"murmur3-32",code:35,encode:e=>fromNumberTo32BitBuf(murmurhash3js_revisited.x86.hash32(e))}),murmur3128=hasher_from({name:"murmur3-128",code:34,encode:e=>fromHex(murmurhash3js_revisited.x64.hash128(e))}),murmur364=hasher_from({name:"murmur3-x64-64",code:34,encode:e=>fromHex(murmurhash3js_revisited.x64.hash128(e)).subarray(0,8)}),Uint8Array_utf8=new TextEncoder,hash64=e=>murmur364.encode(e),Uint8Array_configure=({bitWidth:e=8,hash:t=hash64}={})=>{const r=t(new Uint8Array).byteLength;return{from:e=>t(Uint8Array_utf8.encode(e)),at:(t,n)=>{const o=n*e;if(o>r)throw new RangeError("Out of bounds");return toInt(t,o,e)},size:Math.ceil(8*r/e)}},toInt=(e,t,r)=>{let n=t/8|0,o=t%8,i=r,a=0;for(;i>0&&n<e.byteLength;){const t=8-o,r=t<i?t:i;a=(a<<r)+((255>>o&e[n])>>8-o-r),i-=r,n++,o=0}return a},Uint8Array_empty=(e=256)=>{if(e%8!=0)throw new Error("Must be multiple of 8");return new Uint8Array(e/8)},Uint8Array_from=(e,t)=>{let r=Uint8Array_empty(t);for(const t of e){const{byte:e,byteOffset:n,bitOffset:o}=at(r,t);r[n]=e|1<<o}return r},Uint8Array_size=e=>8*e.byteLength,at=(e,t)=>{const r=e.byteLength-1-(t/8|0),n=t%8;return{byte:e[r],byteOffset:r,bitOffset:n}},setByte=(e,t,r)=>{if(e[t]!==r){const n=e.slice(0);return n[t]=r,n}return e},Uint8Array_set=(e,t)=>{const{byte:r,byteOffset:n,bitOffset:o}=at(e,t);return setByte(e,n,r|1<<o)},Uint8Array_unset=(e,t)=>{const{byte:r,byteOffset:n,bitOffset:o}=at(e,t);return setByte(e,n,r&(255^1<<o))},Uint8Array_get=(e,t)=>{var{byte:r,bitOffset:n}=at(e,t);return!!(r>>n&1)},Uint8Array_toBytes=e=>e,Uint8Array_fromBytes=e=>e,Uint8Array_popcount=(e,t=8*e.byteLength)=>{const{byteOffset:r,bitOffset:n,byte:o}=at(e,t);let i=popcount(o,n),a=e.byteLength-1;for(;a>r;){const t=e[a];i+=bitCount(t),a--}return i},Uint8Array_or=(e,t)=>{const r=e.slice();let n=0;for(;n<e.length;)r[n]|=t[n],n++;return r},Uint8Array_and=(e,t)=>{const r=e.slice();let n=0;for(;n<e.length;)r[n]&=t[n],n++;return r},NOT_FOUND=new RangeError("Not Found"),lib_empty=e=>{const t=lib_configure(e);return new PersistentHashMap(0,createBitmapIndexedNode(t,null),t)},lib_configure=({bitWidth:e=5,BitField:t=(5===e?Uint32_namespaceObject:bitfield_Uint8Array_namespaceObject),Path:r=(5===e?Uint32_configure({bitWidth:e}):Uint8Array_configure({bitWidth:e}))}={})=>({bitWidth:e,BitField:t,Path:r}),lib_from=(e,t)=>{const r=builder(t);for(const[t,n]of e)r.set(t,n);return r.build()},has=(e,t)=>node_get(e.root,t,NOT_FOUND)!==NOT_FOUND,lib_get=(e,t,r=void 0)=>node_get(e.root,t,r),builder=e=>{const t={},r=lib_configure(e);return new HashMapBuilder(t,0,node_create(r,t),r)};class PersistentHashMap{constructor(e=0,t,r){this.count=e,this.root=t,this.config=r}get size(){return this.count}clone(){return new PersistentHashMap(this.count,this.root,this.config)}empty(){return new PersistentHashMap(0,node_create(this.config,null),this.config)}has(e){return has(this,e)}get(e){return node_get(this.root,e,void 0)}set(e,t){const r={value:!1},n=node_set(this.root,null,e,t,r);return n===this.root?this:new PersistentHashMap(r.value?this.count+1:this.count,n,this.config)}delete(e){const t=node_remove(this.root,null,e,{value:!1});return t===this.root?this:new PersistentHashMap(this.count-1,t,this.config)}get bitField(){return this.config.BitField.or(this.root.datamap,this.root.nodemap)}[Symbol.iterator](){return this.entries()}entries(){return this.root.entries()}keys(){return this.root.keys()}values(){return this.root.values()}createBuilder(){return new HashMapBuilder({},this.count,this.root,this.config)}}class HashMapBuilder{constructor(e,t,r,n){this.edit=e,this.count=t,this.root=r,this.config=n}get size(){if(this.edit)return this.count;throw new Error(".size was accessed on the finalized builder")}set(e,t){if(this.edit){const r={value:!1},n=node_set(this.root,this.edit,e,t,r);return this.root!==n&&(this.root=n),r.value&&(this.count+=1),this}throw new Error(".set was called on the finalized builder")}delete(e){if(this.edit){if(0===this.count)return this;const t={value:!1},r=node_remove(this.root,this.edit,e,t);return r!==this.root&&(this.root=r),t.value&&(this.count-=1),this}throw new Error(".delete was called on the finalized builder")}build(){if(this.edit)return this.edit=null,new PersistentHashMap(this.count,this.root,this.config);throw new Error(".build was called on the finalized builder")}}const InfiniteUint8Array_utf8=new TextEncoder,InfiniteUint8Array_hash64=e=>murmur364.encode(e),InfiniteUint8Array_configure=({bitWidth:e=8,hash:t=InfiniteUint8Array_hash64})=>{const r=t(new Uint8Array).byteLength,n={bitWidth:e,hash:t,hashSize:r};return{at:(e,t)=>InfiniteUint8Array_read(e,t,n),from:e=>InfiniteUint8Array_utf8.encode(e),size:1/0}},InfiniteUint8Array_read=(e,t=0,{bitWidth:r=8,hash:n,hashSize:o})=>{const i=8*o;let a=0,s=r,c=r*t;for(;s>0;){const t=c/i|0,r=n(0===t?e:appendByte(e,t)),o=i<=c?c%i:c,u=i-o,l=u<s?u:s;a=(a<<l)+toInt(r,o,l),s-=l,c+=l}return a},appendByte=(e,t)=>{const r=new Uint8Array(e.byteLength+1).fill(t,e.byteLength);return r.set(e),r},bitWidth=8,config={bitWidth,Path:InfiniteUint8Array_configure({bitWidth})},tableSize=e=>Math.pow(2,e.config.bitWidth),unixfs_empty=(e=config)=>HAMT.empty(e),unixfs_builder=(e=config)=>builder(e),unixfs_from=(e,t=config)=>lib_from(e,t),bitField=({datamap:e,nodemap:t,config:{BitField:r}})=>withoutLeadingZeros(r.toBytes(r.or(e,t))),withoutLeadingZeros=e=>{let t=0;for(;t<e.byteLength;){if(0!==e[t])return e.subarray(t);t+=1}return e.subarray(t)},unixfs_iterate=function*(e){const{config:t,datamap:r,nodemap:n}=e,{BitField:o}=t,i=o.size(r);let a=0,s=0;for(;a<i;){const t=a.toString(16).toUpperCase().padStart(2,"0");if(o.get(r,a)){const r=keyAt(e,s);yield{prefix:t,key:r,value:valueAt(e,s)},s++}else o.get(n,a)&&(yield{prefix:t,node:resolveNode(e,a)});a++}};function readonly({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*linksWithin(e,t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))for(const[r,n]of t.entries()){const t=[...e,r],o=cid_CID.asCID(n);null!=o?yield[t.join("/"),o]:"object"==typeof n&&(yield*block_links(n,t))}else{const r=cid_CID.asCID(t);null!=r?yield[e.join("/"),r]:yield*block_links(t,e)}}function*block_links(e,t){if(null==e||e instanceof Uint8Array)return;const r=cid_CID.asCID(e);null!=r&&(yield[t.join("/"),r]);for(const[r,n]of Object.entries(e)){const e=[...t,r];yield*linksWithin(e,n)}}function*treeWithin(e,t){if(Array.isArray(t))for(const[r,n]of t.entries()){const t=[...e,r];yield t.join("/"),"object"==typeof n&&null==cid_CID.asCID(n)&&(yield*tree(n,t))}else yield*tree(t,e)}function*tree(e,t){if(null!=e&&"object"==typeof e)for(const[r,n]of Object.entries(e)){const e=[...t,r];yield e.join("/"),null==n||n instanceof Uint8Array||"object"!=typeof n||null!=cid_CID.asCID(n)||(yield*treeWithin(e,n))}}function block_get(e,t){let r=e;for(const[e,n]of t.entries()){if(r=r[n],null==r)throw new Error(`Object has no property at ${t.slice(0,e+1).map((e=>`[${JSON.stringify(e)}]`)).join("")}`);const o=cid_CID.asCID(r);if(null!=o)return{value:o,remaining:t.slice(e+1).join("/")}}return{value:r}}class Block{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:r}){if(null==e||null==t||void 0===r)throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:readonly(),bytes:readonly(),value:readonly(),asBlock:readonly()})}links(){return block_links(this.value,[])}tree(){return tree(this.value,[])}get(e="/"){return block_get(this.value,e.split("/").filter(Boolean))}}async function block_encode({value:e,codec:t,hasher:r}){if(void 0===e)throw new Error('Missing required argument "value"');if(null==t||null==r)throw new Error("Missing required argument: codec or hasher");const n=t.encode(e),o=await r.digest(n),i=CID.create(1,t.code,o);return new Block({value:e,bytes:n,cid:i})}async function block_decode({bytes:e,codec:t,hasher:r}){if(null==e)throw new Error('Missing required argument "bytes"');if(null==t||null==r)throw new Error("Missing required argument: codec or hasher");const n=t.decode(e),o=await r.digest(e),i=CID.create(1,t.code,o);return new Block({value:n,bytes:e,cid:i})}function createUnsafe({bytes:e,cid:t,value:r,codec:n}){const o=void 0!==r?r:n?.decode(e);if(void 0===o)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Block({cid:t,bytes:e,value:o})}async function block_create({bytes:e,cid:t,hasher:r,codec:n}){if(null==e)throw new Error('Missing required argument "bytes"');if(null==r)throw new Error('Missing required argument "hasher"');const o=n.decode(e),i=await r.digest(e);if(!binary.equals(t.multihash.bytes,i.bytes))throw new Error("CID hash does not match bytes");return createUnsafe({bytes:e,cid:t,value:o,codec:n})}const sharded_directory_configure=configure,sharded_directory_defaults=file_defaults,sharded_directory_create=({writer:e,settings:t=sharded_directory_defaults(),metadata:r={}})=>new HAMTDirectoryWriter({writer:e,metadata:r,settings:t,entries:new HashMap,closed:!1}),sharded_directory_asWritable=e=>{if(e.closed)throw new Error("Can not change written HAMT directory, but you can .fork() and make changes to it");return e},sharded_directory_close=async(e,{closeWriter:t=!1,releaseLock:r=!1}={})=>{const{writer:n,settings:o,metadata:i}=sharded_directory_asWritable(e.state);e.state.closed=!0;const{entries:a}=e.state;if(!(a instanceof HashMap))throw new Error(`not a HAMT: ${a}`);const s=a.builder.build(),c=iterateBlocks(s,s.root,o);let u=null;for await(const e of c)u=e,(n.desiredSize||0)<=0&&await n.ready,n.write(e);if(null==u)throw new Error("no root block yielded");return t?await n.close():r&&n.releaseLock(),{cid:u.cid,dagByteLength:cumulativeDagByteLength(u.bytes,u.value.entries)}},iterateBlocks=async function*(e,t,r){const n=[];for(const o of unixfs_iterate(t))if("key"in o)n.push({name:`${o.prefix??""}${o.key??""}`,dagByteLength:o.value.dagByteLength,cid:o.value.cid});else{let t=null;for await(const n of iterateBlocks(e,o.node,r))yield n,t=n;if(null==t)throw new Error("no root block yielded");n.push({name:o.prefix,dagByteLength:cumulativeDagByteLength(t.bytes,t.value.entries),cid:t.cid})}const o=createDirectoryShard(n,bitField(t),tableSize(e),murmur364.code);yield await encodeHAMTShardBlock(o,r)};async function encodeHAMTShardBlock(e,t){const r=encodeHAMTShard(e),n=await t.hasher.digest(r),o=t.linker.createLink(code,n);return new Block({cid:o,bytes:r,value:e})}const sharded_directory_fork=({state:e},{writer:t=e.writer,metadata:r=e.metadata,settings:n=e.settings}={})=>new HAMTDirectoryWriter({writer:t,metadata:r,settings:n,entries:new HashMap(unixfs_from(e.entries.entries()).createBuilder()),closed:!1});class HAMTDirectoryWriter{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.settings}set(e,t,r){return set(this,e,t,r)}remove(e){return remove(this,e)}fork(e){return sharded_directory_fork(this,e)}close(e){return sharded_directory_close(this,e)}entries(){return this.state.entries.entries()}has(e){return this.state.entries.has(e)}get size(){return this.state.entries.size}}class HashMap extends Map{constructor(e=unixfs_builder()){super(),this.builder=e}clear(){this.builder=unixfs_builder()}delete(e){const{root:t}=this.builder;return this.builder.delete(e),this.builder.root!==t}forEach(e,t=this){for(const[r,n]of this.builder.root.entries())e.call(t,n,r,this)}get(e){return lib_get(this.builder,e)}has(e){return has(this.builder,e)}set(e,t){return this.builder.set(e,t),this}get size(){return this.builder.size}[Symbol.iterator](){return this.builder.root.entries()}entries(){return this.builder.root.entries()}keys(){return this.builder.root.keys()}values(){return this.builder.root.values()}}const createWriter=({writable:e,settings:t=file_defaults()})=>new FileSystemWriter({writer:e.getWriter(),settings:t}),lib_close=async(e,{releaseLock:t=!0,closeWriter:r=!0}={})=>(r?await e.writer.close():t&&e.writer.releaseLock(),e);class FileSystemWriter{constructor({writer:e,settings:t}){this.writer=e,this.settings=configure(t)}createFileWriter({settings:e=this.settings,metadata:t}={}){return file_create({writer:this.writer,settings:e,metadata:t})}createDirectoryWriter({settings:e=this.settings,metadata:t}={}){return directory_create({writer:this.writer,settings:e,metadata:t})}close(e){return lib_close(this,e)}}const BLOCK_SIZE_LIMIT=1048576,defaultCapacity=100*BLOCK_SIZE_LIMIT,withCapacity=(e=defaultCapacity)=>({highWaterMark:e,size:e=>e.bytes.length}),raw_name="raw",raw_code=85;function raw_encode(e){return coerce(e)}function raw_decode(e){return coerce(e)}const SHARD_THRESHOLD=1e3,queuingStrategy=withCapacity(),defaultSettings=configure({fileChunkEncoder:raw_namespaceObject,smallFileEncoder:raw_namespaceObject});function createFileEncoderStream(e,t=defaultSettings){const{readable:r,writable:n}=new TransformStream({},queuingStrategy),o=UnixFS.createWriter({writable:n,settings:t}),i=new UnixFsFileBuilder(e);return(async()=>{await i.finalize(o),await o.close()})(),r}class UnixFsFileBuilder{#e;constructor(e){this.#e=e}async finalize(e){const t=file_create(e);return await this.#e.stream().pipeTo(new WritableStream({async write(e){await t.write(e)}})),t.close()}}class UnixFSDirectoryBuilder{entries=new Map;async finalize(e){const t=this.entries.size<=SHARD_THRESHOLD?directory_create(e):sharded_directory_create(e);for(const[r,n]of this.entries){const o=await n.finalize(e);t.set(r,o)}return t.close()}}function createDirectoryEncoderStream(e,t=defaultSettings){const r=new UnixFSDirectoryBuilder;for(const t of e){const e=t.name.split("/");""!==e[0]&&"."!==e[0]||e.shift();let n=r;for(const[r,o]of e.entries()){if(r===e.length-1){n.entries.set(o,new UnixFsFileBuilder(t));break}let i=n.entries.get(o);if(null==i&&(i=new UnixFSDirectoryBuilder,n.entries.set(o,i)),!(i instanceof UnixFSDirectoryBuilder))throw new Error(`"${o}" cannot be a file and a directory`);n=i}}const{readable:n,writable:o}=new TransformStream({},queuingStrategy),i=createWriter({writable:o,settings:t});return(async()=>{await r.finalize(i),await i.close()})(),n}var node_modules_varint=__webpack_require__(203);const typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(typeofs.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(isBuffer(e))return"Buffer";const r=getObjectType(e);return r||"Object"}function isBuffer(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function getObjectType(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(objectTypeNames.includes(t))return t}class token_Type{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}token_Type.uint=new token_Type(0,"uint",!0),token_Type.negint=new token_Type(1,"negint",!0),token_Type.bytes=new token_Type(2,"bytes",!0),token_Type.string=new token_Type(3,"string",!0),token_Type.array=new token_Type(4,"array",!1),token_Type.map=new token_Type(5,"map",!1),token_Type.tag=new token_Type(6,"tag",!1),token_Type.float=new token_Type(7,"float",!0),token_Type.false=new token_Type(7,"false",!0),token_Type.true=new token_Type(7,"true",!0),token_Type.null=new token_Type(7,"null",!0),token_Type.undefined=new token_Type(7,"undefined",!0),token_Type.break=new token_Type(7,"break",!0);class Token{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,byte_utils_textDecoder=new TextDecoder,byte_utils_textEncoder=new TextEncoder;function byte_utils_isBuffer(e){return useBuffer&&globalThis.Buffer.isBuffer(e)}function asU8A(e){return e instanceof Uint8Array?byte_utils_isBuffer(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const byte_utils_toString=useBuffer?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):utf8Slice(e,t,r):(e,t,r)=>r-t>64?byte_utils_textDecoder.decode(e.subarray(t,r)):utf8Slice(e,t,r),byte_utils_fromString=useBuffer?e=>e.length>64?globalThis.Buffer.from(e):utf8ToBytes(e):e=>e.length>64?byte_utils_textEncoder.encode(e):utf8ToBytes(e),fromArray=e=>Uint8Array.from(e),byte_utils_slice=useBuffer?(e,t,r)=>byte_utils_isBuffer(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),concat=useBuffer?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),asU8A(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},alloc=useBuffer?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e),byte_utils_toHex=null,byte_utils_fromHex=null;function byte_utils_toBytes(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function compare(e,t){if(byte_utils_isBuffer(e)&&byte_utils_isBuffer(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function utf8ToBytes(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=63&o|128):55296==(64512&o)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++n)),t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=63&o|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=63&o|128)}return t}function utf8Slice(e,t,r){const n=[];for(;t<r;){const o=e[t];let i=null,a=o>239?4:o>223?3:o>191?2:1;if(t+a<=r){let r,n,s,c;switch(a){case 1:o<128&&(i=o);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&o)<<6|63&r,c>127&&(i=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&o)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[t+1],n=e[t+2],s=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&s)&&(c=(15&o)<<18|(63&r)<<12|(63&n)<<6|63&s,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,a=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),t+=a}return decodeCodePointsArray(n)}const MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){const t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}const defaultChunkSize=256;class Bl{constructor(e=defaultChunkSize){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=alloc(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=byte_utils_slice(r,0,this.cursor)}else t=concat(this.chunks,this.cursor);return e&&this.reset(),t}}const common_decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:",uintMinorPrefixBytes=[];function assertEnoughData(e,t,r){if(e.length-t<r)throw new Error(`${common_decodeErrPrefix} not enough data for type`)}uintMinorPrefixBytes[23]=1,uintMinorPrefixBytes[24]=2,uintMinorPrefixBytes[25]=3,uintMinorPrefixBytes[26]=5,uintMinorPrefixBytes[27]=9;const uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8(e,t,r){assertEnoughData(e,t,1);const n=e[t];if(!0===r.strict&&n<uintBoundaries[0])throw new Error(`${common_decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint16(e,t,r){assertEnoughData(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<uintBoundaries[1])throw new Error(`${common_decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint32(e,t,r){assertEnoughData(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<uintBoundaries[2])throw new Error(`${common_decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint64(e,t,r){assertEnoughData(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(!0===r.strict&&i<uintBoundaries[3])throw new Error(`${common_decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(!0===r.allowBigInt)return i;throw new Error(`${common_decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8(e,t,r,n){return new Token(token_Type.uint,readUint8(e,t+1,n),2)}function decodeUint16(e,t,r,n){return new Token(token_Type.uint,readUint16(e,t+1,n),3)}function decodeUint32(e,t,r,n){return new Token(token_Type.uint,readUint32(e,t+1,n),5)}function decodeUint64(e,t,r,n){return new Token(token_Type.uint,readUint64(e,t+1,n),9)}function encodeUint(e,t){return encodeUintValue(e,0,t.value)}function encodeUintValue(e,t,r){if(r<uintBoundaries[0]){const n=Number(r);e.push([t|n])}else if(r<uintBoundaries[1]){const n=Number(r);e.push([24|t,n])}else if(r<uintBoundaries[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<uintBoundaries[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<uintBoundaries[4]))throw new Error(`${common_decodeErrPrefix} encountered BigInt larger than allowable range`);{const r=[27|t,0,0,0,0,0,0,0];let o=Number(n&BigInt(4294967295)),i=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&o,o>>=8,r[7]=255&o,o>>=8,r[6]=255&o,o>>=8,r[5]=255&o,r[4]=255&i,i>>=8,r[3]=255&i,i>>=8,r[2]=255&i,i>>=8,r[1]=255&i,e.push(r)}}}function decodeNegint8(e,t,r,n){return new Token(token_Type.negint,-1-readUint8(e,t+1,n),2)}function decodeNegint16(e,t,r,n){return new Token(token_Type.negint,-1-readUint16(e,t+1,n),3)}function decodeNegint32(e,t,r,n){return new Token(token_Type.negint,-1-readUint32(e,t+1,n),5)}encodeUint.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)},encodeUintValue.encodedSize=function(e){return e<uintBoundaries[0]?1:e<uintBoundaries[1]?2:e<uintBoundaries[2]?3:e<uintBoundaries[3]?5:9},encodeUint.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"!=typeof o){const e=-1-o;if(e>=Number.MIN_SAFE_INTEGER)return new Token(token_Type.negint,e,9)}if(!0!==n.allowBigInt)throw new Error(`${common_decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(token_Type.negint,neg1b-BigInt(o),9)}function encodeNegint(e,t){const r=t.value,n="bigint"==typeof r?r*neg1b-pos1b:-1*r-1;encodeUintValue(e,t.type.majorEncoded,n)}function toToken(e,t,r,n){assertEnoughData(e,t,r+n);const o=byte_utils_slice(e,t+r,t+r+n);return new Token(token_Type.bytes,o,r+n)}function decodeBytesCompact(e,t,r,n){return toToken(e,t,1,r)}function decodeBytes8(e,t,r,n){return toToken(e,t,2,readUint8(e,t+1,n))}function decodeBytes16(e,t,r,n){return toToken(e,t,3,readUint16(e,t+1,n))}function decodeBytes32(e,t,r,n){return toToken(e,t,5,readUint32(e,t+1,n))}function decodeBytes64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"==typeof o)throw new Error(`${common_decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken(e,t,9,o)}function tokenBytes(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===token_Type.string?byte_utils_fromString(e.value):e.value),e.encodedBytes}function encodeBytes(e,t){const r=tokenBytes(t);encodeUintValue(e,t.type.majorEncoded,r.length),e.push(r)}function compareBytes(e,t){return e.length<t.length?-1:e.length>t.length?1:compare(e,t)}function _3string_toToken(e,t,r,n,o){const i=r+n;assertEnoughData(e,t,i);const a=new Token(token_Type.string,byte_utils_toString(e,t+r,t+i),i);return!0===o.retainStringBytes&&(a.byteValue=byte_utils_slice(e,t+r,t+i)),a}function decodeStringCompact(e,t,r,n){return _3string_toToken(e,t,1,r,n)}function decodeString8(e,t,r,n){return _3string_toToken(e,t,2,readUint8(e,t+1,n),n)}function decodeString16(e,t,r,n){return _3string_toToken(e,t,3,readUint16(e,t+1,n),n)}function decodeString32(e,t,r,n){return _3string_toToken(e,t,5,readUint32(e,t+1,n),n)}function decodeString64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"==typeof o)throw new Error(`${common_decodeErrPrefix} 64-bit integer string lengths not supported`);return _3string_toToken(e,t,9,o,n)}encodeNegint.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*neg1b-pos1b:-1*t-1;return r<uintBoundaries[0]?1:r<uintBoundaries[1]?2:r<uintBoundaries[2]?3:r<uintBoundaries[3]?5:9},encodeNegint.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},encodeBytes.encodedSize=function(e){const t=tokenBytes(e);return encodeUintValue.encodedSize(t.length)+t.length},encodeBytes.compareTokens=function(e,t){return compareBytes(tokenBytes(e),tokenBytes(t))};const encodeString=encodeBytes;function _4array_toToken(e,t,r,n){return new Token(token_Type.array,n,r)}function decodeArrayCompact(e,t,r,n){return _4array_toToken(e,t,1,r)}function decodeArray8(e,t,r,n){return _4array_toToken(e,t,2,readUint8(e,t+1,n))}function decodeArray16(e,t,r,n){return _4array_toToken(e,t,3,readUint16(e,t+1,n))}function decodeArray32(e,t,r,n){return _4array_toToken(e,t,5,readUint32(e,t+1,n))}function decodeArray64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"==typeof o)throw new Error(`${common_decodeErrPrefix} 64-bit integer array lengths not supported`);return _4array_toToken(e,t,9,o)}function decodeArrayIndefinite(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${common_decodeErrPrefix} indefinite length items not allowed`);return _4array_toToken(e,t,1,1/0)}function encodeArray(e,t){encodeUintValue(e,token_Type.array.majorEncoded,t.value)}function _5map_toToken(e,t,r,n){return new Token(token_Type.map,n,r)}function decodeMapCompact(e,t,r,n){return _5map_toToken(e,t,1,r)}function decodeMap8(e,t,r,n){return _5map_toToken(e,t,2,readUint8(e,t+1,n))}function decodeMap16(e,t,r,n){return _5map_toToken(e,t,3,readUint16(e,t+1,n))}function decodeMap32(e,t,r,n){return _5map_toToken(e,t,5,readUint32(e,t+1,n))}function decodeMap64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"==typeof o)throw new Error(`${common_decodeErrPrefix} 64-bit integer map lengths not supported`);return _5map_toToken(e,t,9,o)}function decodeMapIndefinite(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${common_decodeErrPrefix} indefinite length items not allowed`);return _5map_toToken(e,t,1,1/0)}function encodeMap(e,t){encodeUintValue(e,token_Type.map.majorEncoded,t.value)}function decodeTagCompact(e,t,r,n){return new Token(token_Type.tag,r,1)}function decodeTag8(e,t,r,n){return new Token(token_Type.tag,readUint8(e,t+1,n),2)}function decodeTag16(e,t,r,n){return new Token(token_Type.tag,readUint16(e,t+1,n),3)}function decodeTag32(e,t,r,n){return new Token(token_Type.tag,readUint32(e,t+1,n),5)}function decodeTag64(e,t,r,n){return new Token(token_Type.tag,readUint64(e,t+1,n),9)}function encodeTag(e,t){encodeUintValue(e,token_Type.tag.majorEncoded,t.value)}encodeArray.compareTokens=encodeUint.compareTokens,encodeArray.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)},encodeMap.compareTokens=encodeUint.compareTokens,encodeMap.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)},encodeTag.compareTokens=encodeUint.compareTokens,encodeTag.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};const MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined(e,t,r,n){if(!1===n.allowUndefined)throw new Error(`${common_decodeErrPrefix} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new Token(token_Type.null,null,1):new Token(token_Type.undefined,void 0,1)}function decodeBreak(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${common_decodeErrPrefix} indefinite length items not allowed`);return new Token(token_Type.break,void 0,1)}function createToken(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error(`${common_decodeErrPrefix} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${common_decodeErrPrefix} Infinity values are not supported`)}return new Token(token_Type.float,e,t)}function decodeFloat16(e,t,r,n){return createToken(readFloat16(e,t+1),3,n)}function decodeFloat32(e,t,r,n){return createToken(readFloat32(e,t+1),5,n)}function decodeFloat64(e,t,r,n){return createToken(readFloat64(e,t+1),9,n)}function encodeFloat(e,t,r){const n=t.value;if(!1===n)e.push([token_Type.float.majorEncoded|MINOR_FALSE]);else if(!0===n)e.push([token_Type.float.majorEncoded|MINOR_TRUE]);else if(null===n)e.push([token_Type.float.majorEncoded|MINOR_NULL]);else if(void 0===n)e.push([token_Type.float.majorEncoded|MINOR_UNDEFINED]);else{let t,o=!1;r&&!0===r.float64||(encodeFloat16(n),t=readFloat16(ui8a,1),n===t||Number.isNaN(n)?(ui8a[0]=249,e.push(ui8a.slice(0,3)),o=!0):(encodeFloat32(n),t=readFloat32(ui8a,1),n===t&&(ui8a[0]=250,e.push(ui8a.slice(0,5)),o=!0))),o||(encodeFloat64(n),t=readFloat64(ui8a,1),ui8a[0]=251,e.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){encodeFloat16(r);let e=readFloat16(ui8a,1);if(r===e||Number.isNaN(r))return 3;if(encodeFloat32(r),e=readFloat32(ui8a,1),r===e)return 5}return 9};const buffer=new ArrayBuffer(9),dataView=new DataView(buffer,1),ui8a=new Uint8Array(buffer,0);function encodeFloat16(e){if(e===1/0)dataView.setUint16(0,31744,!1);else if(e===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN(e))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,e);const t=dataView.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)dataView.setUint16(0,31744,!1);else if(0===r)dataView.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?dataView.setUint16(0,0):e<-14?dataView.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):dataView.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function readFloat16(e,t){if(e.length-t<2)throw new Error(`${common_decodeErrPrefix} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,o=1023&r;let i;return i=0===n?o*2**-24:31!==n?(o+1024)*2**(n-25):0===o?1/0:NaN,32768&r?-i:i}function encodeFloat32(e){dataView.setFloat32(0,e,!1)}function readFloat32(e,t){if(e.length-t<4)throw new Error(`${common_decodeErrPrefix} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function encodeFloat64(e){dataView.setFloat64(0,e,!1)}function readFloat64(e,t){if(e.length-t<8)throw new Error(`${common_decodeErrPrefix} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function invalidMinor(e,t,r){throw new Error(`${common_decodeErrPrefix} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function errorer(e){return()=>{throw new Error(`${common_decodeErrPrefix} ${e}`)}}encodeFloat.compareTokens=encodeUint.compareTokens;const jump_jump=[];for(let e=0;e<=23;e++)jump_jump[e]=invalidMinor;jump_jump[24]=decodeUint8,jump_jump[25]=decodeUint16,jump_jump[26]=decodeUint32,jump_jump[27]=decodeUint64,jump_jump[28]=invalidMinor,jump_jump[29]=invalidMinor,jump_jump[30]=invalidMinor,jump_jump[31]=invalidMinor;for(let e=32;e<=55;e++)jump_jump[e]=invalidMinor;jump_jump[56]=decodeNegint8,jump_jump[57]=decodeNegint16,jump_jump[58]=decodeNegint32,jump_jump[59]=decodeNegint64,jump_jump[60]=invalidMinor,jump_jump[61]=invalidMinor,jump_jump[62]=invalidMinor,jump_jump[63]=invalidMinor;for(let e=64;e<=87;e++)jump_jump[e]=decodeBytesCompact;jump_jump[88]=decodeBytes8,jump_jump[89]=decodeBytes16,jump_jump[90]=decodeBytes32,jump_jump[91]=decodeBytes64,jump_jump[92]=invalidMinor,jump_jump[93]=invalidMinor,jump_jump[94]=invalidMinor,jump_jump[95]=errorer("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)jump_jump[e]=decodeStringCompact;jump_jump[120]=decodeString8,jump_jump[121]=decodeString16,jump_jump[122]=decodeString32,jump_jump[123]=decodeString64,jump_jump[124]=invalidMinor,jump_jump[125]=invalidMinor,jump_jump[126]=invalidMinor,jump_jump[127]=errorer("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)jump_jump[e]=decodeArrayCompact;jump_jump[152]=decodeArray8,jump_jump[153]=decodeArray16,jump_jump[154]=decodeArray32,jump_jump[155]=decodeArray64,jump_jump[156]=invalidMinor,jump_jump[157]=invalidMinor,jump_jump[158]=invalidMinor,jump_jump[159]=decodeArrayIndefinite;for(let e=160;e<=183;e++)jump_jump[e]=decodeMapCompact;jump_jump[184]=decodeMap8,jump_jump[185]=decodeMap16,jump_jump[186]=decodeMap32,jump_jump[187]=decodeMap64,jump_jump[188]=invalidMinor,jump_jump[189]=invalidMinor,jump_jump[190]=invalidMinor,jump_jump[191]=decodeMapIndefinite;for(let e=192;e<=215;e++)jump_jump[e]=decodeTagCompact;jump_jump[216]=decodeTag8,jump_jump[217]=decodeTag16,jump_jump[218]=decodeTag32,jump_jump[219]=decodeTag64,jump_jump[220]=invalidMinor,jump_jump[221]=invalidMinor,jump_jump[222]=invalidMinor,jump_jump[223]=invalidMinor;for(let e=224;e<=243;e++)jump_jump[e]=errorer("simple values are not supported");jump_jump[244]=invalidMinor,jump_jump[245]=invalidMinor,jump_jump[246]=invalidMinor,jump_jump[247]=decodeUndefined,jump_jump[248]=errorer("simple values are not supported"),jump_jump[249]=decodeFloat16,jump_jump[250]=decodeFloat32,jump_jump[251]=decodeFloat64,jump_jump[252]=invalidMinor,jump_jump[253]=invalidMinor,jump_jump[254]=invalidMinor,jump_jump[255]=decodeBreak;const jump_quick=[];for(let e=0;e<24;e++)jump_quick[e]=new Token(token_Type.uint,e,1);for(let e=-1;e>=-24;e--)jump_quick[31-e]=new Token(token_Type.negint,e,1);function quickEncodeToken(e){switch(e.type){case token_Type.false:return fromArray([244]);case token_Type.true:return fromArray([245]);case token_Type.null:return fromArray([246]);case token_Type.bytes:return e.value.length?void 0:fromArray([64]);case token_Type.string:return""===e.value?fromArray([96]):void 0;case token_Type.array:return 0===e.value?fromArray([128]):void 0;case token_Type.map:return 0===e.value?fromArray([160]):void 0;case token_Type.uint:return e.value<24?fromArray([Number(e.value)]):void 0;case token_Type.negint:if(e.value>=-24)return fromArray([31-Number(e.value)])}}jump_quick[64]=new Token(token_Type.bytes,new Uint8Array(0),1),jump_quick[96]=new Token(token_Type.string,"",1),jump_quick[128]=new Token(token_Type.array,0,1),jump_quick[160]=new Token(token_Type.map,0,1),jump_quick[244]=new Token(token_Type.false,!1,1),jump_quick[245]=new Token(token_Type.true,!0,1),jump_quick[246]=new Token(token_Type.null,null,1);const defaultEncodeOptions={float64:!1,mapSorter,quickEncodeToken};function makeCborEncoders(){const e=[];return e[token_Type.uint.major]=encodeUint,e[token_Type.negint.major]=encodeNegint,e[token_Type.bytes.major]=encodeBytes,e[token_Type.string.major]=encodeString,e[token_Type.array.major]=encodeArray,e[token_Type.map.major]=encodeMap,e[token_Type.tag.major]=encodeTag,e[token_Type.float.major]=encodeFloat,e}const cborEncoders=makeCborEncoders(),buf=new Bl;class Ref{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${encodeErrPrefix} object contains circular references`);return new Ref(t,e)}}const simpleTokens={null:new Token(token_Type.null,null),undefined:new Token(token_Type.undefined,void 0),true:new Token(token_Type.true,!0),false:new Token(token_Type.false,!1),emptyArray:new Token(token_Type.array,0),emptyMap:new Token(token_Type.map,0)},typeEncoders={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new Token(e>=0?token_Type.uint:token_Type.negint,e):new Token(token_Type.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new Token(token_Type.uint,e):new Token(token_Type.negint,e),Uint8Array:(e,t,r,n)=>new Token(token_Type.bytes,e),string:(e,t,r,n)=>new Token(token_Type.string,e),boolean:(e,t,r,n)=>e?simpleTokens.true:simpleTokens.false,null:(e,t,r,n)=>simpleTokens.null,undefined:(e,t,r,n)=>simpleTokens.undefined,ArrayBuffer:(e,t,r,n)=>new Token(token_Type.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new Token(token_Type.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[simpleTokens.emptyArray,new Token(token_Type.break)]:simpleTokens.emptyArray;n=Ref.createCheck(n,e);const o=[];let i=0;for(const t of e)o[i++]=objectToTokens(t,r,n);return r.addBreakTokens?[new Token(token_Type.array,e.length),o,new Token(token_Type.break)]:[new Token(token_Type.array,e.length),o]},Object(e,t,r,n){const o="Object"!==t,i=o?e.keys():Object.keys(e),a=o?e.size:i.length;if(!a)return!0===r.addBreakTokens?[simpleTokens.emptyMap,new Token(token_Type.break)]:simpleTokens.emptyMap;n=Ref.createCheck(n,e);const s=[];let c=0;for(const t of i)s[c++]=[objectToTokens(t,r,n),objectToTokens(o?e.get(t):e[t],r,n)];return sortMapEntries(s,r),r.addBreakTokens?[new Token(token_Type.map,a),s,new Token(token_Type.break)]:[new Token(token_Type.map,a),s]}};typeEncoders.Map=typeEncoders.Object,typeEncoders.Buffer=typeEncoders.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${e}Array`]=typeEncoders.DataView;function objectToTokens(e,t={},r){const n=is(e),o=t&&t.typeEncoders&&t.typeEncoders[n]||typeEncoders[n];if("function"==typeof o){const i=o(e,n,t,r);if(null!=i)return i}const i=typeEncoders[n];if(!i)throw new Error(`${encodeErrPrefix} unsupported type: ${n}`);return i(e,n,t,r)}function sortMapEntries(e,t){t.mapSorter&&e.sort(t.mapSorter)}function mapSorter(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const o=r.type.major,i=cborEncoders[o].compareTokens(r,n);return 0===i&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function tokensToEncoded(e,t,r,n){if(Array.isArray(t))for(const o of t)tokensToEncoded(e,o,r,n);else r[t.type.major](e,t,n)}function encodeCustom(e,t,r){const n=objectToTokens(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const o=t[n.type.major];if(o.encodedSize){const e=o.encodedSize(n,r),t=new Bl(e);if(o(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return asU8A(t.chunks[0])}}return buf.reset(),tokensToEncoded(buf,n,t,r),buf.toBytes(!0)}function encode_encode(e,t){return t=Object.assign({},defaultEncodeOptions,t),encodeCustom(e,cborEncoders,t)}const defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tokeniser{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=quick[e];if(void 0===t){const r=jump[e];if(!r)throw new Error(`${decodeErrPrefix} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const n=31&e;t=r(this.data,this._pos,n,this.options)}return this._pos+=t.encodedLength,t}}const DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray(e,t,r){const n=[];for(let o=0;o<e.value;o++){const i=tokensToObject(t,r);if(i===BREAK){if(e.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(i===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${o}, expected ${e.value})`);n[o]=i}return n}function tokenToMap(e,t,r){const n=!0===r.useMaps,o=n?void 0:{},i=n?new Map:void 0;for(let a=0;a<e.value;a++){const s=tokensToObject(t,r);if(s===BREAK){if(e.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(s===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(!0!==n&&"string"!=typeof s)throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof s})`);if(!0===r.rejectDuplicateMapKeys&&(n&&i.has(s)||!n&&s in o))throw new Error(`${decodeErrPrefix} found repeat map key "${s}"`);const c=tokensToObject(t,r);if(c===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${a} [no value], expected ${e.value})`);n?i.set(s,c):o[s]=c}return n?i:o}function tokensToObject(e,t){if(e.done())return DONE;const r=e.next();if(r.type===Type.break)return BREAK;if(r.type.terminal)return r.value;if(r.type===Type.array)return tokenToArray(r,e,t);if(r.type===Type.map)return tokenToMap(r,e,t);if(r.type===Type.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=tokensToObject(e,t);return t.tags[r.value](n)}throw new Error(`${decodeErrPrefix} tag not supported (${r.value})`)}throw new Error("unsupported")}function decodeFirst(e,t){if(!(e instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);const r=(t=Object.assign({},defaultDecodeOptions,t)).tokenizer||new Tokeniser(e,t),n=tokensToObject(r,t);if(n===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(n===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);return[n,e.subarray(r.pos())]}function decode_decode(e,t){const[r,n]=decodeFirst(e,t);if(n.length>0)throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return r}const CID_CBOR_TAG=42;function src_toByteView(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}function cidEncoder(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=cid_CID.asCID(e);if(!t)return null;const r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new Token(token_Type.tag,CID_CBOR_TAG),new Token(token_Type.bytes,r)]}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const _encodeOptions={float64:!0,typeEncoders:{Object:cidEncoder,undefined:undefinedEncoder,number:numberEncoder}},encodeOptions={..._encodeOptions,typeEncoders:{..._encodeOptions.typeEncoders}};function cidDecoder(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return cid_CID.decode(e.subarray(1))}const _decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};_decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;const decodeOptions={..._decodeOptions,tags:_decodeOptions.tags.slice()},dag_cbor_src_name="dag-cbor",src_code=113,dag_cbor_src_encode=e=>encode_encode(e,_encodeOptions),dag_cbor_src_decode=e=>cborg.decode(src_toByteView(e),_decodeOptions);function encodeHeader(e){const t=dag_cbor_src_encode({version:1,roots:e}),r=node_modules_varint.encode(t.length),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n}function encodeBlock(e){const t=node_modules_varint.encode(e.cid.bytes.length+e.bytes.length),r=new Uint8Array(t.length+e.cid.bytes.length+e.bytes.length);return r.set(t),r.set(e.cid.bytes,t.length),r.set(e.bytes,t.length+e.cid.bytes.length),r}class CAREncoderStream extends TransformStream{constructor(e=[]){super({start:t=>t.enqueue(encodeHeader(e)),transform:(e,t)=>{t.enqueue(encodeBlock(e)),this.finalBlock=e}}),this.finalBlock=null}}function folderLoader_typeof(e){return folderLoader_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},folderLoader_typeof(e)}function folderLoader_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function folderLoader_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?folderLoader_ownKeys(Object(r),!0).forEach((function(t){folderLoader_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):folderLoader_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function folderLoader_defineProperty(e,t,r){return(t=folderLoader_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function folderLoader_regeneratorRuntime(){folderLoader_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==folderLoader_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(folderLoader_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function folderLoader_asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function folderLoader_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){folderLoader_asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){folderLoader_asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function folderLoader_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function folderLoader_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,folderLoader_toPropertyKey(n.key),n)}}function folderLoader_createClass(e,t,r){return t&&folderLoader_defineProperties(e.prototype,t),r&&folderLoader_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function folderLoader_toPropertyKey(e){var t=folderLoader_toPrimitive(e,"string");return"symbol"==folderLoader_typeof(t)?t:t+""}function folderLoader_toPrimitive(e,t){if("object"!=folderLoader_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=folderLoader_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var FolderLoader=function(){return folderLoader_createClass((function e(t){folderLoader_classCallCheck(this,e),this.httpService=t,this.report=new report(this.httpService),this.abortController=null}),[{key:"uploadFile",value:(n=folderLoader_asyncToGenerator(folderLoader_regeneratorRuntime().mark((function e(t,r,n,o,i){var a,s,c,u;return folderLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.httpService.uploadFile(t,r,n,o,i);case 3:if(0===(a=e.sent).code){e.next=6;break}return e.abrupt("return",onHandleData({code:a.code,msg:"Failed to upload file: "+a.msg,data:null!==(s=a.data)&&void 0!==s?s:{}}));case 6:return e.abrupt("return",a);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",onHandleData({code:e.t0.code,msg:null!==(c="Failed to upload file: "+e.t0.msg)&&void 0!==c?c:"",data:null!==(u=e.t0.data)&&void 0!==u?u:{}}));case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,t,r,o,i){return n.apply(this,arguments)})},{key:"handleFolderUpload",value:(r=folderLoader_asyncToGenerator(folderLoader_regeneratorRuntime().mark((function e(t,r,n,o){var i,a,s,c,u,l,d,f,h,p,y,m,g,v,b,_,w,k,S,E,T,L,x=this;return folderLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.areaId,a=void 0===i?[]:i,s=r.groupId,c=void 0===s?0:s,u=r.extraId,l=void 0===u?"":u,d=r.retryCount,f=void 0===d?3:d,h=[],Date.now(),e.prev=4,e.next=7,this.createDirectoryStream(t,o);case 7:if(0===(m=e.sent).code){e.next=10;break}return e.abrupt("return",m);case 10:return g=t[0].webkitRelativePath.split("/")[0],v={asset_name:g,asset_type:"folder",asset_size:m.data.blob.size,group_id:c,asset_cid:m.data.rootCid,extra_id:l,need_trace:!0},b=-1===c,_={},_=folderLoader_objectSpread(folderLoader_objectSpread({},v),{},b?{area_ids:a}:{area_id:a}),e.next=17,this.httpService.postFileUpload({isLoggedIn:!b,areaIds:a,assetData:_});case 17:if(w=e.sent,k=function(){var e=folderLoader_asyncToGenerator(folderLoader_regeneratorRuntime().mark((function e(r,n,o){var i,a,s,c,u,l,d,f,p,y;return folderLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new URL(r.CandidateAddr),c=s.hostname.split(".")[0],u=Date.now(),e.next=5,x.uploadFile(r.CandidateAddr,r.Token,n,x.abortController.signal,(function(e,t,r){o&&o(e,t,r)}));case 5:return l=e.sent,d=null!==(i=r.TraceID)&&void 0!==i?i:"",f=Date.now(),p=f-u,y=Math.floor(t.size/p*1e3),h.push(folderLoader_objectSpread({status:0===l.code?1:2,msg:l.msg,elapsedTime:p,transferRate:y,size:n.size,traceId:d,nodeId:c,cId:null!==(a=l.cid)&&void 0!==a?a:"",log:0===l.code?"":folderLoader_defineProperty({},c,l.msg)},l)),e.abrupt("return",l);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),console.log(111,w.data),!(w.data.err&&1017===w.data.err||0==w.data.code&&0==(null!==(p=w.data.List)&&void 0!==p?p:[]).length)){e.next=22;break}return e.abrupt("return",onHandleData({code:0,data:{cid:m.data.rootCid,isAlreadyExist:!0,url:w.data.assetDirectUrl}}));case 22:if(0===w.code){e.next=24;break}return e.abrupt("return",w);case 24:return S=null!==(y=w.data.List)&&void 0!==y?y:[],e.next=27,this.uploadWithRetry(S,k,f,m.data.blob,n);case 27:if(E=e.sent,this.report.creatReportData(h,"upload"),0!==E.code){e.next=33;break}return e.abrupt("return",folderLoader_objectSpread(folderLoader_objectSpread({},E),{},{cid:m.data.rootCid}));case 33:return e.abrupt("return",{code:-1,msg:null!==(T=E.msg)&&void 0!==T?T:"Upload addresses failed.",data:null!==(L=E.data)&&void 0!==L?L:{}});case 34:e.next=39;break;case 36:return e.prev=36,e.t0=e.catch(4),e.abrupt("return",onHandleData({code:codes.FAILURE,msg:e.t0}));case 39:case"end":return e.stop()}}),e,this,[[4,36]])}))),function(e,t,n,o){return r.apply(this,arguments)})},{key:"createDirectoryStream",value:(t=folderLoader_asyncToGenerator(folderLoader_regeneratorRuntime().mark((function e(t,r){var n,o=this;return folderLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.abortController=new AbortController,e.prev=1,e.abrupt("return",new Promise((function(e,n){var i,a;createDirectoryEncoderStream(t).pipeThrough(new TransformStream({transform:function(e,t){a=e.cid,t.enqueue(e)}}),{signal:o.abortController.signal}).pipeThrough(new CAREncoderStream,{signal:o.abortController.signal}).pipeTo(new WritableStream({write:function(e){if(i){if(!i||!e)throw new Error("myFile or chunk is undefined");var t=new Uint8Array(i.length+e.length);t.set(i),t.set(e,i.length),i=t}else i=e;r&&r("writing")},close:function(){r&&r("close"),e(onHandleData({code:0,data:{blob:new Blob([i]),rootCid:a.toString()}}))},abort:function(e){r&&r("abort"),n(onHandleData({code:codes.UPLOAD_FILE_ERROR,msg:e||"Stream aborted"}))}}),{signal:o.abortController.signal}).catch((function(e){n(onHandleData({code:codes.UPLOAD_FILE_ERROR,msg:e.message||"Unknown error during upload"}))}))})));case 5:return e.prev=5,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:e.t0.code,msg:null!==(n="Failed to upload file: "+e.t0.msg)&&void 0!==n?n:""}));case 8:case"end":return e.stop()}}),e,this,[[1,5]])}))),function(e,r){return t.apply(this,arguments)})},{key:"uploadWithRetry",value:(e=folderLoader_asyncToGenerator(folderLoader_regeneratorRuntime().mark((function e(t,r,n,o,i){var a;return folderLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=folderLoader_asyncToGenerator(folderLoader_regeneratorRuntime().mark((function e(s){var c,u,l;return folderLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s>=t.length)){e.next=2;break}return e.abrupt("return",{code:codes.UPLOAD_FILE_ERROR,msg:"All upload addresses failed."});case 2:c=folderLoader_regeneratorRuntime().mark((function e(a){var c;return folderLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return log("Processing address ".concat(s+1,"/").concat(t.length,", attempt ").concat(a+1,"/").concat(n)),e.prev=1,e.next=4,r(t[s],o,i);case 4:if(log("uploadWithRetry",c=e.sent),0!==c.code&&-200!=c.code){e.next=8;break}return e.abrupt("return",{v:c});case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,new Promise((function(e){return setTimeout(e,1e3*Math.pow(2,a))}));case 14:case"end":return e.stop()}}),e,null,[[1,10]])})),l=0;case 4:if(!(l<n)){e.next=12;break}return e.delegateYield(c(l),"t0",6);case 6:if(!(u=e.t0)){e.next=9;break}return e.abrupt("return",u.v);case 9:l++,e.next=4;break;case 12:return e.abrupt("return",a(s+1));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",a(0));case 2:case"end":return e.stop()}}),e)}))),function(t,r,n,o,i){return e.apply(this,arguments)})},{key:"delayRetry",value:function(e){return new Promise((function(t){return setTimeout(t,1e3*Math.pow(2,e))}))}},{key:"handleUploadError",value:function(){return{code:codes.UPLOAD_FILE_ERROR,msg:"Upload addresses failed."}}},{key:"cancelUpload",value:function(){this.abortController&&(this.abortController.abort("Upload cancelled by user"),this.abortController=null)}}]);var e,t,r,n}();const folderLoader=FolderLoader;function downfolder_typeof(e){return downfolder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},downfolder_typeof(e)}function downfolder_defineProperty(e,t,r){return(t=downfolder_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function downfolder_regeneratorRuntime(){downfolder_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==downfolder_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(downfolder_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function downfolder_asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function downfolder_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){downfolder_asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){downfolder_asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function downfolder_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function downfolder_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,downfolder_toPropertyKey(n.key),n)}}function downfolder_createClass(e,t,r){return t&&downfolder_defineProperties(e.prototype,t),r&&downfolder_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function downfolder_toPropertyKey(e){var t=downfolder_toPrimitive(e,"string");return"symbol"==downfolder_typeof(t)?t:t+""}function downfolder_toPrimitive(e,t){if("object"!=downfolder_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=downfolder_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var DownFolder=function(){return downfolder_createClass((function e(t){downfolder_classCallCheck(this,e),this.concurrentLimit=3,this.progressCallback=null,this.chunkQueue=[],this.downloadedChunks=[],this.maxRetries=3,this.failedChunks=[],this.report=new report(t),this.mimeType="application/octet-stream"}),[{key:"downloadFiles",value:(t=downfolder_asyncToGenerator(downfolder_regeneratorRuntime().mark((function e(t,r,n,o,i){return downfolder_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onprogress=function(e){var t=e.loaded/o*100;t>100&&(t=100),i(r,t)},s.onload=function(){if(200===s.status){var t=document.createElement("a"),n=window.URL.createObjectURL(s.response);t.href=n,t.download=r,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(n),document.body.removeChild(t),e({code:0,msg:"Download successful"})}else a({code:-1,msg:"Download failed"+s.statusText})},s.onerror=function(){a({code:-1,msg:"Download onerror"})},n.signal.addEventListener("abort",(function(){s.abort(),a({code:-1,msg:"Download abort"})})),s.send()})));case 1:case"end":return e.stop()}}),e)}))),function(e,r,n,o,i){return t.apply(this,arguments)})},{key:"downloadFromMultipleUrls",value:(e=downfolder_asyncToGenerator(downfolder_regeneratorRuntime().mark((function e(t,r,n,o,i,a){var s,c,u,l,d,f,h=this;return downfolder_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new AbortController,c=!1,u=[],l=function(e,t){c||a&&a(t.toFixed(2))},d=function(){var e=downfolder_asyncToGenerator(downfolder_regeneratorRuntime().mark((function e(a){var f,p,y,m,g,v,b,_,w;return downfolder_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a>=t.length)){e.next=2;break}return e.abrupt("return",{code:-1,msg:"All url download failed"});case 2:f=Date.now(),p=t[a],y=new URL(p),m=y.hostname.split(".")[0],g=0;case 7:if(!(g<3)||c){e.next=28;break}return g++,e.prev=9,e.next=12,h.downloadFiles(p+"&format=tar",o+".tar",s,i,l);case 12:return v=e.sent,c=!0,s.abort(),b=Date.now(),_=b-f,w=Math.floor(i/_*1e3),u.push({status:1,msg:"successful",elapsedTime:_,transferRate:w,size:i,traceId:r,nodeId:m,cId:n,log:""}),h.report.creatReportData(u,"download"),e.abrupt("return",Promise.resolve(v));case 23:e.prev=23,e.t0=e.catch(9),g>=3&&(u.push({status:2,msg:"failed",elapsedTime:0,transferRate:0,size:i,traceId:r,nodeId:m,cId:n,log:downfolder_defineProperty({},m,e.t0.message)}),h.report.creatReportData(u,"download"));case 26:e.next=7;break;case 28:return e.abrupt("return",d(a+1));case 29:case"end":return e.stop()}}),e,null,[[9,23]])})));return function(t){return e.apply(this,arguments)}}(),e.next=7,d(0);case 7:return f=e.sent,e.abrupt("return",c?f:onHandleData({code:-1,msg:"All url download failed "}));case 9:case"end":return e.stop()}}),e)}))),function(t,r,n,o,i,a){return e.apply(this,arguments)})}]);var e,t}();const downfolder=DownFolder;function downfile_defineProperty(e,t,r){return(t=downfile_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function downfile_typeof(e){return downfile_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},downfile_typeof(e)}function downfile_regeneratorRuntime(){downfile_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==downfile_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(downfile_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function downfile_asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function downfile_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){downfile_asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){downfile_asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function downfile_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function downfile_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,downfile_toPropertyKey(n.key),n)}}function downfile_createClass(e,t,r){return t&&downfile_defineProperties(e.prototype,t),r&&downfile_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function downfile_toPropertyKey(e){var t=downfile_toPrimitive(e,"string");return"symbol"==downfile_typeof(t)?t:t+""}function downfile_toPrimitive(e,t){if("object"!=downfile_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=downfile_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var SimpleLock=function(){return downfile_createClass((function e(){downfile_classCallCheck(this,e),this._locked=!1,this._waiting=[]}),[{key:"acquire",value:(e=downfile_asyncToGenerator(downfile_regeneratorRuntime().mark((function e(){var t=this;return downfile_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._locked){e.next=5;break}return e.next=3,new Promise((function(e){return t._waiting.push(e)}));case 3:e.next=0;break;case 5:this._locked=!0;case 6:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"release",value:function(){(this._locked=!1,this._waiting.length>0)&&this._waiting.shift()()}}]);var e}(),DownloadScheduler=function(){return downfile_createClass((function e(t,r){downfile_classCallCheck(this,e),this.urls=t,this.chunkSize=r,this.chunkQueue=[],this.failedChunks=[],this.completedChunks=[],this.totalSize=0,this.downloadedSize=0,this.urlStatus={};var n,o=_createForOfIteratorHelper(this.urls);try{for(o.s();!(n=o.n()).done;){var i=n.value,a=this.getNodeId(i);this.urlStatus[a]={code:0,msg:""}}}catch(e){o.e(e)}finally{o.f()}}),[{key:"initializeChunks",value:function(e){this.totalSize=e;for(var t=Math.ceil(e/this.chunkSize),r=0;r<t;r++){var n=r*this.chunkSize,o=Math.min(e-1,(r+1)*this.chunkSize-1);this.chunkQueue.push({start:n,end:o})}log("totalChunks: ".concat(t))}},{key:"updateDownloadedSize",value:function(e){this.downloadedSize+=e}},{key:"getProgress",value:function(){return Math.floor(this.downloadedSize/this.totalSize*100)}},{key:"getNextChunk",value:function(){return this.chunkQueue.shift()}},{key:"markChunkFailed",value:function(e,t,r){var n=this.getNodeId(t);this.failedChunks.push(e),this.urlStatus[n].code=2,this.urlStatus[n].msg="".concat(r)}},{key:"markChunkCompleted",value:function(e,t){var r=this.getNodeId(t);this.completedChunks.push(e),this.urlStatus[r].code=1,this.urlStatus[r].msg="completed"}},{key:"hasFailedChunks",value:function(){return this.failedChunks.length>0}},{key:"allChunksCompleted",value:function(){return this.completedChunks.length===Math.ceil(this.totalSize/this.chunkSize)}},{key:"getUrlStatus",value:function(){var e=this;return Object.keys(this.urlStatus).map((function(t){return{nodeId:t,code:e.urlStatus[t].code,msg:e.urlStatus[t].msg}}))}},{key:"getNodeId",value:function(e){return new URL(e).hostname.split(".")[0]}}])}(),DownFile=function(){return downfile_createClass((function e(t){downfile_classCallCheck(this,e),this.maxConcurrentDownloads=10,this.maxRetries=0,this.report=new report(t),this.lock=new SimpleLock,this.progressCallback=null,this.urlStats={},this.mimeType="application/octet-stream",this.hasSuccessfulUrl=!0}),[{key:"calculateSystemLoad",value:function(){return Math.floor(100*Math.random())}},{key:"adjustConcurrency",value:function(){var e=this.calculateSystemLoad();e>80&&this.maxConcurrentDownloads>1?this.maxConcurrentDownloads-=1:e<50&&this.maxConcurrentDownloads<20&&(this.maxConcurrentDownloads+=1)}},{key:"setProgressCallback",value:function(e){this.progressCallback=e}},{key:"initializeUrlStats",value:function(e){var t=this;e.forEach((function(e){t.urlStats[e]={success:0,failure:0}}))}},{key:"checkUrlAvailability",value:(n=downfile_asyncToGenerator(downfile_regeneratorRuntime().mark((function e(t){var r;return downfile_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"HEAD"});case 3:return r=e.sent,e.abrupt("return",r.ok);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(e){return n.apply(this,arguments)})},{key:"getBestUrl",value:function(){for(var e=null,t=-1,r=0,n=Object.entries(this.urlStats);r<n.length;r++){var o=_slicedToArray(n[r],2),i=o[0],a=o[1],s=a.success,c=s+a.failure,u=0===c?0:s/c;u>t&&(t=u,e=i)}return e}},{key:"downloadTask",value:(r=downfile_asyncToGenerator(downfile_regeneratorRuntime().mark((function e(t,r,n){var o,i,a,s,c;return downfile_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,log("Start downloading chunk: ".concat(r.start,"-").concat(r.end," from ").concat(t)),e.next=4,this.downloadChunk(t,r.start,r.end);case 4:if(o=e.sent,i=o.blob,a=o.size,i){e.next=11;break}throw this.urlStats[t].failure++,s="Chunk ".concat(r.start,"-").concat(r.end," failed to download."),new Error(s);case 11:n.markChunkCompleted({start:r.start,blob:i},t),n.updateDownloadedSize(a),log("Chunk downloaded successfully: ".concat(r.start,"-").concat(r.end,", size: ").concat(a)),this.urlStats[t].success++,this.progressCallback&&(c=n.getProgress(),this.progressCallback(c)),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(0),log("Failed to downloadTask chunk: ".concat(r.start,"-").concat(r.end," from ").concat(t),e.t0),n.markChunkFailed(r,t,e.t0),this.urlStats[t].failure++;case 23:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"downloadChunk",value:(t=downfile_asyncToGenerator(downfile_regeneratorRuntime().mark((function e(t,r,n){var o,i;return downfile_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,log("Requesting to download chunk: ".concat(r,"-").concat(n," from ").concat(t)),e.next=5,fetch(t,{headers:{Range:"bytes=".concat(r,"-").concat(n)}});case 5:if((o=e.sent).ok){e.next=8;break}throw new Error("Failed to download range ".concat(r,"-").concat(n));case 8:return e.next=10,o.blob();case 10:return i=e.sent,this.mimeType=o.headers.get("Content-Type"),e.abrupt("return",{blob:i,size:n-r+1});case 15:if(e.prev=15,e.t0=e.catch(1),log("Failed to download chunk: ".concat(r,"-").concat(n,", retry")),!Object.values(this.urlStats).some((function(e){return e.success>0}))){e.next=23;break}throw new Error("Failed to download range ".concat(r,"-").concat(n));case 23:return e.abrupt("return",{blob:null,size:0,error:"Failed: ".concat(r,"-").concat(n,": ").concat(e.t0.message)});case 24:case"end":return e.stop()}}),e,this,[[1,15]])}))),function(e,r,n){return t.apply(this,arguments)})},{key:"downloadFile",value:(e=downfile_asyncToGenerator(downfile_regeneratorRuntime().mark((function e(t,r,n,o,i){var a,s,c,u,l,d,f,h,p,y,m,g,v,b,_,w,k,S,E,T,L,x,A;return downfile_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.initializeUrlStats(t),a=Math.min(1048576,Math.ceil(i/(5*t.length))),(s=new DownloadScheduler(t,a)).initializeChunks(i),c=[],u=[],l=_createForOfIteratorHelper(t),e.prev=7,l.s();case 9:if((d=l.n()).done){e.next=17;break}return f=d.value,e.next=13,this.checkUrlAvailability(f);case 13:e.sent&&c.push(f);case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),l.e(e.t0);case 22:return e.prev=22,l.f(),e.finish(22);case 25:if(0!==c.length){e.next=27;break}return e.abrupt("return",onHandleData({code:-1,msg:"URL downloaded error "}));case 27:h=!1,p=[],y=c.slice(),m=Date.now(),this.adjustConcurrency();case 32:if(h){e.next=81;break}for(;s.chunkQueue.length>0&&p.length<this.maxConcurrentDownloads;)g=s.getNextChunk(),v=y[Math.floor(Math.random()*y.length)],p.push(this.downloadTask(v,g,s));return e.prev=34,e.next=37,Promise.all(p);case 37:e.sent,e.next=45;break;case 40:return e.prev=40,e.t1=e.catch(34),log("All download tasks failed. Exiting."),s.failedChunks=[],e.abrupt("break",81);case 45:if(!s.hasFailedChunks()){e.next=77;break}b=_createForOfIteratorHelper(s.failedChunks),e.prev=47,b.s();case 49:if((_=b.n()).done){e.next=68;break}if(w=_.value,k=this.getBestUrl()){e.next=54;break}return e.abrupt("return",onHandleData({code:-1,msg:"All available URLs failed to download ".concat(w.start,"-").concat(w.end,"  cannot be retried")}));case 54:return e.prev=54,e.next=57,this.downloadChunk(k,w.start,w.end);case 57:S=e.sent,E=S.blob,s.markChunkCompleted({start:w.start,blob:E},k),e.next=66;break;case 62:return e.prev=62,e.t2=e.catch(54),log("Failed to re-download chunk ".concat(w.start,"-").concat(w.end),e.t2),e.abrupt("break",68);case 66:e.next=49;break;case 68:e.next=73;break;case 70:e.prev=70,e.t3=e.catch(47),b.e(e.t3);case 73:return e.prev=73,b.f(),e.finish(73);case 76:s.failedChunks=[];case 77:h=s.allChunksCompleted(),p.length=0,e.next=32;break;case 81:if(T=Date.now(),L=T-m,x=Math.floor(i/L*1e3),(A=this.mergeChunks(s.completedChunks,this.mimeType)).size===i){e.next=91;break}return s.getUrlStatus().forEach((function(e){u.push({status:2,msg:"failed",elapsedTime:0,transferRate:0,size:i,traceId:r,nodeId:e.nodeId,cId:n,log:downfile_defineProperty({},e.nodeId,e.msg)})})),this.report.creatReportData(u,"download"),e.abrupt("return",onHandleData({code:-1,msg:"Failed to download chunk"}));case 91:return s.getUrlStatus().forEach((function(e){u.push({status:1,msg:"successful",elapsedTime:L,transferRate:x,size:i,traceId:r,nodeId:e.nodeId,cId:n,log:""})})),this.saveFile(A,o),this.report.creatReportData(u,"download"),e.abrupt("return",onHandleData({code:0,msg:"File downloaded successfully "}));case 95:case"end":return e.stop()}}),e,this,[[7,19,22,25],[34,40],[47,70,73,76],[54,62]])}))),function(t,r,n,o,i){return e.apply(this,arguments)})},{key:"mergeChunks",value:function(e,t){var r=e.sort((function(e,t){return e.start-t.start}));return new Blob(r.map((function(e){return e.blob})),{type:t})}},{key:"saveFile",value:function(e,t){var r=URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}}]);var e,t,r,n}();const downfile=DownFile;function shareLoader_regeneratorRuntime(){shareLoader_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==shareLoader_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(shareLoader_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function shareLoader_typeof(e){return shareLoader_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},shareLoader_typeof(e)}function shareLoader_asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function shareLoader_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){shareLoader_asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){shareLoader_asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function shareLoader_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function shareLoader_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,shareLoader_toPropertyKey(n.key),n)}}function shareLoader_createClass(e,t,r){return t&&shareLoader_defineProperties(e.prototype,t),r&&shareLoader_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function shareLoader_toPropertyKey(e){var t=shareLoader_toPrimitive(e,"string");return"symbol"==shareLoader_typeof(t)?t:t+""}function shareLoader_toPrimitive(e,t){if("object"!=shareLoader_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=shareLoader_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var ShareLoader=function(){return shareLoader_createClass((function e(t){shareLoader_classCallCheck(this,e),this.httpService=t}),[{key:"onShare",value:(r=shareLoader_asyncToGenerator(shareLoader_regeneratorRuntime().mark((function e(){var t,r,n,o,i,a,s,c,u,l,d,f,h,p,y,m,g,v,b,_,w=arguments;return shareLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.length>0&&void 0!==w[0]?w[0]:{id:null,expireAt:null,shortPass:"",hasDay:!1,hasDomain:!0},e.prev=1,"object"===shareLoader_typeof(t)&&null!==t){e.next=4;break}return e.abrupt("return",onHandleData({code:codes.ASSET_OBJ_ERROR}));case 4:if(r=t.id,n=t.expireAt,o=t.shortPass,i=t.hasDay,a=t.hasDomain,s=void 0===a||a,r){e.next=7;break}return e.abrupt("return",onHandleData({code:codes.ID_KEY_EMPTY}));case 7:return c=/^\d+$/.test(r),u=c?{groupId:r}:{cId:r},e.next=11,this.httpService.getAssetGroupInfo(u);case 11:if((l=e.sent)&&0===l.code&&l.data){e.next=14;break}return e.abrupt("return",onHandleData({code:codes.REQUEST_ERROR}));case 14:if(!c){e.next=24;break}if(m=l.data.data.Group){e.next=18;break}return e.abrupt("return",onHandleData({code:codes.REQUEST_ERROR}));case 18:d=m.ShareStatus,f=m.UserID,h=m.ID,p="folder",e.next=32;break;case 24:if((g=l.data.data.AssetOverview)&&g.UserAssetDetail&&g.AssetRecord){e.next=27;break}return e.abrupt("return",onHandleData({code:codes.REQUEST_ERROR,msg:"AssetOverview data is incomplete."}));case 27:d=g.UserAssetDetail.ShareStatus,f=g.UserAssetDetail.UserID,h=g.AssetRecord.CID,p=g.UserAssetDetail.AssetType,y=g.UserAssetDetail.area_ids;case 32:if(0!==d){e.next=40;break}return v={isNumeric:c,UserID:f,Cid:h,AssetType:p,expireAt:n,shortPass:o,area_ids:y,hasDay:i,hasDomain:s},e.next=36,this.onCreateShareLink(v);case 36:return b=e.sent,e.abrupt("return",b);case 40:return e.next=42,this.onUpdateShareLink(f,h,n,o,i,s);case 42:return _=e.sent,e.abrupt("return",_);case 44:e.next=49;break;case 46:return e.prev=46,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:codes.FAILURE,msg:e.t0}));case 49:case"end":return e.stop()}}),e,this,[[1,46]])}))),function(){return r.apply(this,arguments)})},{key:"onCreateShareLink",value:(t=shareLoader_asyncToGenerator(shareLoader_regeneratorRuntime().mark((function e(t){var r,n,o,i,a,s,c,u,l,d,f,h,p,y,m,g,v,b,_,w,k,S;return shareLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.isNumeric,n=t.UserID,o=t.Cid,i=t.AssetType,a=t.expireAt,s=t.shortPass,c=t.area_ids,u=t.hasDay,l=t.hasDomain,e.prev=1,d=JSON.parse(localStorage.getItem("titanOptions")),f="https://storage.titannet.io",d.url&&(f=d.url),h=r?"/groupPreview":"/distributionstatus",p="".concat(f).concat(h,"?cid=").concat(o,"&AssetType=").concat(i,"&address=").concat(n),c&&c.length>0&&(y="area_id=".concat(encodeURIComponent(c.join(","))),p+="&".concat(y)),m=Math.floor(new Date(4101509461e3).getTime()/1e3),!a){e.next=14;break}if(!(g=Validator.validateExpireAt(a))){e.next=13;break}return e.abrupt("return",g);case 13:m=u?this.getFutureTimestamp(a):a;case 14:if(v="?username=".concat(n,"&cid=").concat(o,"&url=").concat(encodeURIComponent(p),"&expire_time=").concat(m),!s){e.next=20;break}if(!(b=Validator.validateShortPass(s))){e.next=19;break}return e.abrupt("return",b);case 19:v+="&short_pass=".concat(s);case 20:return!r&&c&&c.length>0&&(_=c.map((function(e){return"area_id=".concat(encodeURIComponent(e))})).join("&"),v+="&".concat(_)),e.next=23,this.httpService.createLink(v);case 23:if(0!==(w=e.sent).code){e.next=33;break}return k="?user_id=".concat(n,"&cid=").concat(o),!r&&c&&c.length>0&&(S=c.map((function(e){return"area_id=".concat(encodeURIComponent(e))})).join("&"),k+="&".concat(S)),e.next=29,this.httpService.shareStatusSet(k);case 29:return w.data.url=l?"".concat(f).concat(encodeURI(w.data.url)):encodeURI(w.data.url),e.abrupt("return",onHandleData({code:w.code,msg:w.msg,data:w.data}));case 33:return e.abrupt("return",onHandleData({code:w.code,msg:w.msg,data:w.data}));case 34:e.next=39;break;case 36:return e.prev=36,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:codes.FAILURE,msg:e.t0}));case 39:case"end":return e.stop()}}),e,this,[[1,36]])}))),function(e){return t.apply(this,arguments)})},{key:"getFutureTimestamp",value:function(e){var t=new Date,r=new Date(t.getTime()+24*e*60*60*1e3);return Math.floor(r.getTime()/1e3)}},{key:"onUpdateShareLink",value:(e=shareLoader_asyncToGenerator(shareLoader_regeneratorRuntime().mark((function e(t,r,n,o,i,a){var s,c,u,l,d,f,h,p,y,m,g,v,b,_;return shareLoader_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpService.shareLinkInfo("?username=".concat(t,"&cid=").concat(r));case 2:if(s=e.sent,c=s.data.link,u=c.id,l=c.short_pass,d=c.expire_at,f=c.short_link,h=l,p=new Date(d).getTime()/1e3,!o){e.next=11;break}if(!(y=Validator.validateShortPass(o))){e.next=10;break}return e.abrupt("return",y);case 10:h=o;case 11:if(!n){e.next=16;break}if(!(m=Validator.validateExpireAt(n))){e.next=15;break}return e.abrupt("return",m);case 15:p=i?this.getFutureTimestamp(n):n;case 16:return g={id:u,expire_at:p,short_pass:h},e.next=19,this.httpService.shareLinkUpdate(g);case 19:return 0==(v=e.sent).code&&(a?(b=JSON.parse(localStorage.getItem("titanOptions")),_="https://storage.titannet.io",b.url&&(_=b.url),v.data.url=_+encodeURI(f)):v.data.url=encodeURI(f)),e.abrupt("return",onHandleData({code:v.code,msg:v.msg,data:v.data}));case 22:case"end":return e.stop()}}),e,this)}))),function(t,r,n,o,i,a){return e.apply(this,arguments)})}]);var e,t,r}();const js_shareLoader=ShareLoader;function commService_typeof(e){return commService_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},commService_typeof(e)}function commService_regeneratorRuntime(){commService_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==commService_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(commService_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function commService_asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function commService_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){commService_asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){commService_asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function commService_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function commService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,commService_toPropertyKey(n.key),n)}}function commService_createClass(e,t,r){return t&&commService_defineProperties(e.prototype,t),r&&commService_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function commService_toPropertyKey(e){var t=commService_toPrimitive(e,"string");return"symbol"==commService_typeof(t)?t:t+""}function commService_toPrimitive(e,t){if("object"!=commService_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=commService_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var CommService=function(){return commService_createClass((function e(t){commService_classCallCheck(this,e),this.Http=t,this.httpService=new httpService(t)}),[{key:"updateToken",value:function(e){return"string"==typeof e&&e.trim().length>0?this.Http.updateToken(e):onHandleData({code:codes.BAD_REQUEST,msg:"Invalid API token provided."})}},{key:"updateLanguage",value:(f=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(t){var r;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=this.Http.updateLanguage(t),e.abrupt("return",r);case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",onHandleData({code:codes.FAILURE,msg:e.t0}));case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e){return f.apply(this,arguments)})},{key:"onAreaId",value:(d=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.httpService.getAreaIdList();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:"Failed to get area ID: "+e.t0}));case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return d.apply(this,arguments)})},{key:"onCreateGroup",value:(l=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(t,r){var n,o;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(n=Validator.validateGroupName(t))){e.next=5;break}return log(n),e.abrupt("return",n);case 5:if(!(o=Validator.validateParentId(r))){e.next=9;break}return log(o),e.abrupt("return",n);case 9:return e.next=11,this.httpService.createGroup(t,r);case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:"Failed to create group: "+e.t0}));case 17:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e,t){return l.apply(this,arguments)})},{key:"onAssetGroupList",value:(u=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(t,r,n){var o,i,a;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(o=Validator.validateParentId(r))){e.next=5;break}return log(o),e.abrupt("return",o);case 5:if(!(i=Validator.validatePage(t))){e.next=9;break}return log(i),e.abrupt("return",i);case 9:if(!(a=Validator.validatePageSize(n))){e.next=13;break}return log(a),e.abrupt("return",a);case 13:return e.next=15,this.httpService.onAssetGroupList(t,r,n);case 15:return e.abrupt("return",e.sent);case 18:return e.prev=18,e.t0=e.catch(0),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:"Failed to asset list: "+e.t0}));case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e,t,r){return u.apply(this,arguments)})},{key:"renameGroup",value:(c=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){var t,r,n,o=arguments;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{groupId:-1,name:""},e.prev=1,!(r=Validator.validateGroupName(t.name))){e.next=6;break}return log(r),e.abrupt("return",r);case 6:if(!(n=Validator.validateGroupId(t.groupId))){e.next=9;break}return e.abrupt("return",n);case 9:return e.next=11,this.httpService.renameGroup(t);case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:"Failed to rename group: "+e.t0}));case 17:case"end":return e.stop()}}),e,this,[[1,14]])}))),function(){return c.apply(this,arguments)})},{key:"renameAsset",value:(s=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){var t,r,n,o=arguments;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{assetId:-1,name:""},e.prev=1,!(r=Validator.validateGroupName(t.name))){e.next=6;break}return log(r),e.abrupt("return",r);case 6:if(!(n=Validator.validateAssetCid(t.assetId))){e.next=9;break}return e.abrupt("return",n);case 9:return e.next=11,this.httpService.renameAsset(t);case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:"Failed to rename asset: "+e.t0}));case 17:case"end":return e.stop()}}),e,this,[[1,14]])}))),function(){return s.apply(this,arguments)})},{key:"deleteGroup",value:(a=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{groupId:-1},e.prev=1,!(r=Validator.validateGroupId(t.groupId))){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,this.httpService.deleteGroup(t);case 7:return e.abrupt("return",e.sent);case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:"Failed to delete group: "+e.t0}));case 13:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(){return a.apply(this,arguments)})},{key:"deleteAsset",value:(i=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){var t,r=arguments;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{assetId:-1,areaId:[]},e.prev=1,-1!==t.assetId){e.next=4;break}return e.abrupt("return",onHandleData({code:codes.ID_KEY_EMPTY,msg:"Asset ID is required"}));case 4:return e.next=6,this.httpService.deleteAsset(t);case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:"Failed to delete asset: "+e.t0}));case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(){return i.apply(this,arguments)})},{key:"getAssetGroupInfo",value:(o=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){var t,r=arguments;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{cId:-1,groupId:-1},e.prev=1,-1!==t.cId||-1!==t.groupId){e.next=4;break}return e.abrupt("return",onHandleData({code:codes.ID_KEY_EMPTY,msg:"At least one ID (cId or groupId) is required"}));case 4:return e.next=6,this.httpService.getAssetGroupInfo(t);case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:""+e.t0}));case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(){return o.apply(this,arguments)})},{key:"userInfo",value:(n=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.httpService.userInfo();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:"Failed to retrieve user information: "+e.t0}));case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return n.apply(this,arguments)})},{key:"onShare",value:(r=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{id:null,expireAt:null,shortPass:"",hasDay:!1,hasDomain:!0},e.prev=1,r=new js_shareLoader(this.httpService),e.abrupt("return",r.onShare(t));case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",onHandleData({code:codes.INTERNAL_SERVER_ERROR,msg:""+e.t0}));case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return r.apply(this,arguments)})},{key:"onFileUpload",value:(t=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(t){var r,n,o,i,a,s,c=this,u=arguments;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:{areaId:[],groupId:0,assetType:0,extraId:"",retryCount:3},o=u.length>2?u[2]:void 0,i=u.length>3?u[3]:void 0,a=u.length>4?u[4]:void 0,!(s=Validator.validateUploadOptions(t,null!==(r=n.areaId)&&void 0!==r?r:[],n.groupId,n.assetType))){e.next=7;break}return e.abrupt("return",s);case 7:if(0!==n.assetType){e.next=15;break}return this.uploadLoader=new uploadLoader(this.httpService),a&&a((function(){return c.uploadLoader.cancelUpload()})),e.next=12,this.uploadLoader.onFileUpload(t,n,o,i);case 12:case 20:return e.abrupt("return",e.sent);case 15:if(1!==n.assetType){e.next=23;break}return this.folderLoader=new folderLoader(this.httpService),a&&a((function(){return c.folderLoader.cancelUpload()})),e.next=20,this.folderLoader.handleFolderUpload(t,n,o,i);case 23:return e.abrupt("return",onHandleData({code:codes.Asset_Type_ERROR}));case 24:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onFileDown",value:(e=commService_asyncToGenerator(commService_regeneratorRuntime().mark((function e(){var t,r,n,o,i,a,s,c,u,l,d,f,h,p,y,m,g,v,b,_,w=arguments;return commService_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=w.length>1?w[1]:void 0,n=(t=w.length>0&&void 0!==w[0]?w[0]:{areaId:"",assetCid:"",assetType:"",userId:"",hasTempFile:!1,tempFileName:"",fileSize:0}).assetCid,o=t.assetType,i=t.userId,a=t.areaId,s=t.hasTempFile,c=t.tempFileName,u=t.fileSize,!(l=Validator.validateAssetCid(n))){e.next=6;break}return e.abrupt("return",l);case 6:return e.next=8,this.httpService.getFileDownURL({assetCid:n,userId:i,areaId:a,hasTempFile:s});case 8:if(0!==(d=e.sent).code){e.next=37;break}if(h=function(e){var t=new URL(e);return new URLSearchParams(t.search).get("filename")},p=d.data.url,(y=h(p[0]))||(y=c),m=null!==(f=d.data.size)&&void 0!==f?f:u,g=d.data.trace_id,"folder"!=o){e.next=24;break}return v=new downfolder(this.httpService),e.next=20,v.downloadFromMultipleUrls(p,g,n,y,m,r);case 20:return b=e.sent,e.abrupt("return",b);case 24:if("file"!=o){e.next=34;break}return(_=new downfile(this.httpService)).setProgressCallback((function(e){r&&r(e)})),e.next=29,_.downloadFile(p,g,n,y,m);case 29:return log("downresult.file",b=e.sent),e.abrupt("return",b);case 34:return e.abrupt("return",onHandleData({code:codes.Dowload_Type_ERROR,msg:"Failed to downresult: "}));case 35:e.next=38;break;case 37:return e.abrupt("return",d);case 38:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]);var e,t,r,n,o,i,a,s,c,u,l,d,f}();const commService=CommService;function titanStorage_typeof(e){return titanStorage_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},titanStorage_typeof(e)}function titanStorage_regeneratorRuntime(){titanStorage_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),s=new D(n||[]);return o(a,"_invoke",{value:L(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",p="executing",y="completed",m={};function g(){}function v(){}function b(){}var _={};u(_,a,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(j([])));k&&k!==r&&n.call(k,a)&&(_=k);var S=b.prototype=g.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==titanStorage_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function L(t,r,n){var o=f;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=x(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function x(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(titanStorage_typeof(t)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function titanStorage_asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function titanStorage_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){titanStorage_asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){titanStorage_asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function titanStorage_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function titanStorage_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,titanStorage_toPropertyKey(n.key),n)}}function titanStorage_createClass(e,t,r){return t&&titanStorage_defineProperties(e.prototype,t),r&&titanStorage_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function titanStorage_defineProperty(e,t,r){return(t=titanStorage_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function titanStorage_toPropertyKey(e){var t=titanStorage_toPrimitive(e,"string");return"symbol"==titanStorage_typeof(t)?t:t+""}function titanStorage_toPrimitive(e,t){if("object"!=titanStorage_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=titanStorage_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var TitanStorage=function(){function e(t){var r=t.token,n=t.url,o=t.debug,i=void 0!==o&&o;titanStorage_classCallCheck(this,e),this.commService=new commService(new Http(r,n,i))}return titanStorage_createClass(e,[{key:"updateToken",value:(p=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(t){var r;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.commService.updateToken(t),e.abrupt("return",r);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateLanguage",value:(h=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(t){var r;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.commService.updateLanguage(t),e.abrupt("return",r);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"listRegions",value:(f=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.commService.onAreaId();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"createFolder",value:(d=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{name:"",parent:0},e.next=3,this.commService.onCreateGroup(t.name,t.parent);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"listDirectoryContents",value:(l=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{page:1,parent:0,pageSize:10},e.next=3,this.commService.onAssetGroupList(t.page,t.parent,t.pageSize);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"renameFolder",value:(u=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{groupId:-1,name:""},e.next=3,this.commService.renameGroup(t);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"renameAsset",value:(c=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{assetId:-1,name:""},e.next=3,this.commService.renameAsset(t);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"deleteFolder",value:(s=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{groupId:-1},e.next=3,this.commService.deleteGroup(t);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"deleteAsset",value:(a=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{assetId:-1,areaId:[]},e.next=3,this.commService.deleteAsset(t);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getUserProfile",value:(i=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.commService.userInfo();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getltemDetails",value:(o=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{cId:-1,groupId:-1},e.next=3,this.commService.getAssetGroupInfo(t);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"createSharedLink",value:(n=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{id:null,expireAt:null,shortPass:"",hasDay:!1,hasDomain:!0},e.next=3,this.commService.onShare(t);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"uploadAsset",value:(r=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(t,r,n,o,i){var a;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.commService.onFileUpload(t,r,n,o,i);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,o,i){return r.apply(this,arguments)})},{key:"downloadAsset",value:(t=titanStorage_asyncToGenerator(titanStorage_regeneratorRuntime().mark((function e(){var t,r,n,o=arguments;return titanStorage_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{areaId:"",assetCid:"",assetType:"",userId:"",hasTempFile:!1,tempFileName:"",fileSize:0},r=o.length>1?o[1]:void 0,e.next=4,this.commService.onFileDown(t,r);case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{token:"",debug:!1,url:""};try{var r=Validator.validateApiKey(t.token);if(r)return log(r),r;localStorage.setItem("titanOptions",JSON.stringify(t)),e.instance=new e(t);var n=onHandleData({code:codes.SUCCESSFULLY});return log(n),n}catch(e){return onHandleData({code:codes.InitSdk_ERROR})}}},{key:"getInstance",value:function(){if(!e.instance){var t=JSON.parse(localStorage.getItem("titanOptions")),r=Validator.validateApiKey(t.token);r&&log(r),e.instance=new e(t)}return e.instance}}]);var t,r,n,o,i,a,s,c,u,l,d,f,h,p}();titanStorage_defineProperty(TitanStorage,"instance",null);const titanStorage=TitanStorage;var __webpack_exports__default=__webpack_exports__.A;export{__webpack_exports__default as default};